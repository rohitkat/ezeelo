@using PagedList;
@using PagedList.Mvc;

@*@model IPagedList<ModelLayer.Models.DeliveryOrderDetail>*@

@model IPagedList<DeliveryPartner.Models.ViewModel.DeliveryIndexViewModel>

@{
    ViewBag.Title = "List [ Order Tracking ]";
}
<style>
    .a_white {
        color: #ffffff !important;
    }

    .close {
        float: right;
        font-size: 20px;
        font-weight: bold;
        line-height: 18px;
        color: #000000;
        text-shadow: 0 1px 0 #ffffff;
        opacity: 1 !important;
        filter: alpha(opacity=100) !important;
    }

    .modal1.fade.in {
        top: 10% !important;
        width: auto;
        bottom: 10% !important;
    }

    .modal1 {
        position: fixed;
        top: 50%;
        /* left: 50%; */
        z-index: 1050;
        overflow: auto;
        width: 560px;
        margin: 0px 0 0 0px !important;
        background-color: #ffffff;
        border: 1px solid #999;
        border: 1px solid rgba(0, 0, 0, 0.3);
        -webkit-border-radius: 6px;
        -moz-border-radius: 6px;
        border-radius: 6px;
        -webkit-box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3);
        -moz-box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3);
        box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3);
        -webkit-background-clip: padding-box;
        -moz-background-clip: padding-box;
        background-clip: padding-box;
    }

    .modal1-body {
        overflow-y: auto;
        max-height: 400px;
        padding: 15px;
        overflow-x: hidden;
    }

    input {
        width: 80px;
    }
    .accordion-heading {
         background: none; 
    }

    .accordion-group {
        margin-bottom: 0px;
        border: 0px solid #e5e5e5;
        -webkit-border-radius: 4px;
        -moz-border-radius: 4px;
        border-radius: 4px;
    }
    .table td {
        padding: 2px;
    }
</style>
<div class="row">
    <div class="span12" id="divtable1">
        <div class="widget">
            <div class="widget-header">
                <i class="icon-list-alt"></i>
                <h3> List [ Order Tracking ]</h3>
            </div>
            <!-- /widget-header -->
            <div class="widget-content">
                <div class="widget big-stats-container">
                    <div class="widget-content" style="overflow-x:auto;">
                        @using (Html.BeginForm("Index", "DeliveryOrderDetail", FormMethod.Post))
                        {   @Html.AntiForgeryToken()
                            <div class="form-horizontal">
                                <table>
                                    <tr>
                                        <td>From Date</td>
                                        <td>@Html.TextBox("FromDate", null, new { @readonly = "readonly", id = "FromDate" })</td>
                                        <td>To Date</td>
                                        <td>@Html.TextBox("ToDate", null, new { @readonly = "readonly", id = "ToDate" })</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>Delivery Type</td>
                                        <td>@Html.DropDownList("DeliveryType", "All") </td>
                                        <td>Order Status</td>
                                        <td>@Html.DropDownList("DeliveryStatus", "All")</td>
                                        <td>Order Code</td>
                                        <td>@Html.TextBox("SearchString", ViewBag.SearchString as string, new { @class = "search" })</td>
                                        <td>
                                            <button type="submit" value="Search" class="btn btn-small btn-warning">
                                                <span class="glyphicon glyphicon-search"></span> Search
                                            </button>
                                            <button type="button" class="btn btn-small btn-info" id="btn_clear">Clear</button>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        }
                        @if (Model.Count() == 0)
                        {
                            <table class="table table-bordered table-hover table-responsive table-striped">
                                <tr>
                                    <th style="">Sr.No</th>
                                    <th style="">
                                        eZeelo Order Code
                                    </th>
                                    <th style="">
                                        Order Code
                                    </th>
                                    <th style="">
                                        Weight
                                    </th>
                                    <th style="">
                                        Order Amount
                                    </th>
                                    <th style="">
                                        Delivery Charge
                                    </th>
                                    <th style="">
                                        Delivery Type
                                    </th>
                                    <th style="">
                                        Create Date
                                    </th>
                                    @*Tejaswee 26-11-2015*@
                                    <th style="">
                                        Delivery Date
                                    </th>
                                    <th style="">
                                        Delivery Slot
                                    </th>
                                    @*<th style="width:130px;">Delivery Memo</th>*@
                                    <th style="">Status</th>
                                    <th style="">Actions</th>
                                    <th style="">Logs</th>
                                </tr>
                                <tr>
                                    <td colspan="6" class="text-center"><h3>No Record Found...</h3></td>
                                </tr>
                            </table>
                        }
                        else
                        {
                            <div class="accordion" id="accordion2">
                                @{ int i = 1; }
                                <table class="table table-bordered table-hover table-responsive table-striped">
                                    <tr>
                                        <th style="">Sr.No</th>
                                        <th style="">
                                            eZeelo Order Code
                                        </th>
                                        <th style="">
                                            Order Code
                                        </th>
                                        <th style="">
                                            Weight
                                        </th>
                                        <th style="">
                                            Order Amount
                                        </th>
                                        <th style="">
                                            Delivery Charge
                                        </th>
                                        <th style="">
                                            Delivery Type
                                        </th>
                                        <th style="">
                                            Create Date
                                        </th>
                                        @*Tejaswee 26-11-2015*@
                                        <th style="">
                                            Delivery Date
                                        </th>
                                        <th style="">
                                            Delivery Slot
                                        </th>
                                        @*<th style="width:130px;">Delivery Memo</th>*@
                                        <th style="">Status</th>
                                        <th style="">Actions</th>
                                        <th colspan="2" style="">Logs</th>
                                        
                                    </tr>
                                    @foreach (var item in Model)
                                    {
                                        <tr>
                                            <td style="width: 16px;">@{int SrNo = ((ViewBag.PageNumber - 1) * ViewBag.PageSize) + i; i = i + 1; } @SrNo </td>
                                            <td style="">
                                                @Html.DisplayFor(modelItem => item.GandhibaghOrderCode)
                                            </td>
                                            <td style=" ">
                                                @Html.DisplayFor(modelItem => item.ShopOrderCode)
                                            </td>
                                            <td style="">
                                                @Html.DisplayFor(modelItem => item.Weight)
                                            </td>
                                            <td style="">
                                                <span class="indian_currency"></span>@Html.DisplayFor(modelItem => item.OrderAmount)
                                            </td>
                                            <td style="">
                                                @*<span class="indian_currency"></span>@Html.DisplayFor(modelItem => item.DeliveryCharge)*@
                                                <span class="indian_currency"></span>@Html.DisplayFor(modelItem => item.GandhibaghCharge)
                                            </td>
                                            <td style=" ">
                                                @Html.DisplayFor(modelItem => item.DeliveryType)
                                            </td>
                                            <td style=" ">
                                                @Html.DisplayFor(modelItem => item.CreateDate)
                                            </td>
                                            @*Tejaswee (26-11-2015) Display expected delivery time and date*@
                                            <td style="">
                                                @if (item.DeliveryDate != null)
                                                {
                                                    @*@Html.DisplayFor(modelItem => item.DeliveryDate.Value.Date.ToString("dd/mm/yy"))*@
                                                    <span>@item.DeliveryDate.Value.ToString("dd / MM / yyyy")</span>
                                                }
                                            </td>
                                            <td style="">
                                                @Html.DisplayFor(modelItem => item.DeliveryScheduleName)
                                            </td>

                                            @*<td style="width:130px; text-align:center;">
                        <a href="#myModal" role="button" class="btn btn-small btn-primary" data-toggle="modal" onclick="Details(@item.ID)">Delivery Memo</a>
                    </td>*@
                                            <td style=" ">
                                                @*@item.CustomerOrderStatus*@
                                                @Enum.GetName(typeof(DeliveryPartner.Common.Constant.ORDER_STATUS), item.OrderStatus)
                                            </td>
                                            <td style="">
                                                <a class="accordion-toggle margin_padding_zero" data-toggle="collapse" data-parent="#accordion2" href="#@item.ID"><span class="btn btn-small btn-danger">Actions</span></a>
                                            </td>
                                            <td style="">
                                                <a href="@Url.Action("Index", "DeliveryDetailLog", new { DeliveryOrderDetailID = item.ID })" onclick="Logs()" target="frameLog" class="btn btn-small btn-success a_white">Logs</a>
                                            </td>
                                            
                                        </tr>
                                        <tr style="min-height:100px;">
                                            <td colspan="20">
                                                <div id="@item.ID" class="accordion-body collapse">
                                                    @*<div class="accordion-inner">
            <div class="row">*@
                                                    <div class="widget-content">
                                                        <a href="#myModal" role="button" class="btn btn-small btn-primary" data-toggle="modal" onclick="Details(@item.ID)">Delivery Memo</a>
                                                        @*<a href="@Url.Action("Details", "DeliveryOrderDetail")?id=' + id">Delivery Memo</a>*@
                                                        <iframe id="frameCreate_@item.ID" name="frameCreate_@item.ID" src='@Url.Action("Edit", "DeliveryOrderDetail", new { id = item.ID })' width="100%" height="220px" frameborder="0"></iframe>
                                                    </div>
                                                    @*</div>
            </div>*@
                                                </div>
                                            </td>
                                        </tr>

                                        
                                    }
                                </table>
                            </div>
                        }



                        <div class="pager">
                            @Html.PagedListPager(Model, Page => Url.Action("Index", new
                       {
                           page = Page,
                           SearchString = ViewBag.SearchString,
                           FromDate = ViewBag.FromDate,
                           ToDate = ViewBag.ToDate,
                           DeliveryStatus = ViewBag.DeliveryStatus1,
                           DeliveryType = ViewBag.DeliveryType1
                       }),
                                                                new PagedListRenderOptions()
                                                                {
                                                                    Display = PagedListDisplayMode.IfNeeded
                                                                })
                        </div>
                    </div>
                    <!-- /widget-content -->
                </div>
            </div>
        </div>
    </div>
    <!-- /span12 -->
    <div class="span5" id="divLog">
        <div class="loader">
            <img id="loader_img" src="~/Content/Images/loader.gif" style="display: none" />
        </div>
        <div id="Details">
            <iframe id="frameLog" name="frameLog" src='' width="100%" height="600px" frameborder="0" style="margin:0px; padding:0px;"></iframe>
        </div>
    </div>


</div>
<!-- Modal -->
<div id="myModal" class="modal1 hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
        <div class="close"><button type="button" class="btn btn-danger btn-small" data-dismiss="modal" aria-hidden="true">×</button></div>
        <h4 id="myModalLabel">Delivery Memo</h4>
    </div>
    <div id="modalBody" class="modal1-body">
        <div id="diliveryMemo"></div>
    </div>
    @*<div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>*@
    @*<button class="btn btn-primary">Save changes</button>*@
    @*</div>*@
</div>
@section MyScripts{
    <script>

        //----------------------------------------------------------------------For datepicker---//
        //<![CDATA[
        $(window).load(function () {
            //$('#DOB').datepicker('setDate', new Date());
            $('#FromDate').datepicker('update');
            $('#ToDate').datepicker('update');
        });//]]>



        function Logs(id) {
            $('#divtable1').removeClass('span12');
            $('#divtable1').addClass('span7');
            window.parent.$("[id$=divLog]").show();

            @*$.ajax({
            url: '@Url.Action("Create", "DeliveryDetailLog")?DeliveryOrderDetailID=' + id,
            type: "GET",
            success: function (result) {
                $('#loader_img').hide();
                $('#Details').html(result);
            },
            error: function (data) {
                $('#Details').empty();
                $('#loader_img').hide();
            }
        });*@
        }

        function Details(id) {
            $.ajax({
                url: '@Url.Action("Details", "DeliveryOrderDetail")?id=' + id,
                type: "GET",
                success: function (result) {
                    //$('#loader_img').hide();
                    $('#diliveryMemo').html(result);
                },
                error: function (data) {
                    $('#diliveryMemo').empty();
                    //$('#loader_img').hide();
                }
            });
        }
    </script>
}



