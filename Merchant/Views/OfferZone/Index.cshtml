@model IEnumerable<ModelLayer.Models.ViewModel.ProductOfferViewModel>

@{
    ViewBag.Title = "Index";
    //Layout = null;
}

<style>
    .btnOffer {
        background-color: #F0AF4E;
        border: 1px solid #F0AF4E;
        padding: 3px;
        color: #fff;
     }

    #tblOfferList tbody tr th tr {
    }
    .sroll-div{overflow-y:scroll!important;
              height:200px;
    }
   
</style>
@*<h2>List Of Offers</h2>*@

@*<p> @Html.ActionLink("Create New", "Create")
    </p>*@
@*<div id="content" style="min-height:230px;">*@
<div id="content" class="span10">
    <div class="box-header">
        <h2><i class="icon-edit"></i><span class="break"></span> Offer Zone</h2>
       
    </div>
    <div class="box-content sroll-div" style="height:158px;">
        <table class="table table-striped table-bordered" id="tblOfferList" style="border: 1px Solid #B3A185;">
            <thead>
                <tr>
                    <th>
                        @Html.DisplayNameFor(model => model.OfferName)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.DiscountInRs)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.DiscountInPercent)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.StartDateTime)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.EndDateTime)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.MinPurchaseQty)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.FreeOty)
                    </th>
                    <th></th>
                </tr>
            </thead>
            @foreach (var item in Model)
            {
                <tbody>
                    <tr>
                        <td>
                            @Html.Label(item.OfferName, new { @class="OfferName"})
                            <input type="hidden" value="@item.OfferID" class="hdnOfferId" />
                        </td>

                        <td>
                            <label class="DiscountInRs">@item.DiscountInRs</label>
                        </td>
                        <td>
                            <label class="DiscountInPercent">@item.DiscountInPercent</label>

                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.StartDateTime)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.EndDateTime)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.MinPurchaseQty)
                        </td>
                        <td>
                            <label class="FreeOty">@item.FreeOty</label>
                        </td>
                        <td>
                            <input type="button" id="btn#@item.OfferID" class="btnOffer" value="Apply Offer" onclick="LoadProducts(this.id);" />
                            @*@Html.ActionLink("Apply Offer", "Edit", new { OfferID=item.OfferID })*@
                        </td>
                    </tr>
                </tbody>
            }

        </table>
    </div>
 <div id="divPartialProduct" class="box-content">
 </div>
      <div class="loader">
            <img id="loader_img" src="~/Content/img/loader.gif" style="display: none" />
        </div>
    </div>
<script src="~/Content/js/jquery-1.9.1.min.js"></script>
<script>
    var PageIndex;
    //$(function () {
    function LoadProducts(ID) {
        $("[id$=divPartialProduct]").html("");
        $('#loader_img').show();
        //alert('in');
        var Id = ID.split('#');
        var OfferID = Id[1];
        var OfferName = $("[id*=" + ID + "]").closest('tr').find('.OfferName').html();
        var DiscountInRs = $("[id*=" + ID + "]").closest('tr').find('.DiscountInRs').html();
        var DiscountInPercent = $("[id*=" + ID + "]").closest('tr').find('.DiscountInPercent').html();
        var CategoryID = 0;
        PageIndex = 1;
        var PageSize = 10;
        $.ajax({
            url: '@Url.Action("LoadProducts", "OfferZone")',
            data: { 'OfferID': OfferID, 'OfferName': OfferName, 'PageIndex': PageIndex, 'PageSize': PageSize, 'DiscountInRs': DiscountInRs, 'DiscountInPercent': DiscountInPercent,'CategoryID':CategoryID},
            type: "Post",
            cache: false,
            success: function (data) {
                //$("[id=divPartialProduct]").html("");
                setTimeout(function () {
                    $("[id$=divPartialProduct]").html(data);
                }, 1000);
                //$("[id$=divPartialProduct]").html(data);
                setTimeout(function () {
                    BindSavedOffersToProduct(OfferID);
                }, 1000);
                $('#loader_img').hide();
                //setTimeout(function () {
                //    $('#loader_img').hide();
                //}, 2000);

            },
            error: function (data) {

            }

        });


    }


    function BindSavedOffersToProduct(OfferID) {
        $.ajax({
            url: '@Url.Action("BindSavedOffersToProduct", "OfferZone")',
            data: { 'OfferID': OfferID },
            type: "Post",
            cache: false,
            success: function (data) {
                $.each(data, function (index, item) {
                    $("#tblProduct tr:gt(2)").each(function () {
                        var ShopStockID = $(this).closest('tr').find('.chkApply').val();
                        if (item == ShopStockID) {
                            $(this).closest('tr').find('.chkApply').attr('checked', true);
                        }
                    });
                });

            },
            error: function (data) {

            }
        });
       
       
    }
</script>
