@model IEnumerable<ModelLayer.Models.ViewModel.ProductOfferViewModel>

@{
    ViewBag.Title = "Index";
    //Layout = null;
}

<style>
    .btnOffer {
        background-color: #F0AF4E;
        border: 1px solid #F0AF4E;
        padding: 3px;
        color: #fff;
    }
    .sroll-div {
        overflow-y: scroll !important;
        height: 200px;
    }
   
</style>

<div class="span10" id="content">
    
            <div class="box-header">
                <h2><i class="icon-edit"></i><span class="break"></span>Component Offer Zone</h2>

            </div>
            <div class="box-content ">
                <table class="table table-striped table-bordered" id="tblOfferList" style="border: 1px Solid #B3A185;">
                    <tr>

                        <th>
                            @Html.DisplayNameFor(model => model.OfferName)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.ComponentName)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.DiscountInRs)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.DiscountInPercent)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.StartDateTime)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.EndDateTime)
                        </th>

                        <th>Action</th>
                    </tr>

                    @foreach (var item in Model)
                    {
                        <tr>

                            <td>
                                @Html.Label(item.OfferName, new { @class = "OfferName" })
                                <input type="hidden" value="@item.OfferID" class="hdnOfferId" />
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.ComponentName)
                                <input type="hidden" value="@item.ComponentId" class="hdnComponentId" />
                            </td>
                            <td>
                                <label class="DiscountInRs">@item.DiscountInRs</label>
                            </td>
                            <td>
                                <label class="DiscountInPercent">@item.DiscountInPercent</label>

                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.StartDateTime)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.EndDateTime)
                            </td>

                            <td>
                                <input type="button" id="btn#@item.OfferID" class="btnOffer" value="Apply Offer" onclick="LoadProducts(this.id);" />
                               </td>
                        </tr>
                    }

                </table>
            </div>
        
    <div id="divPartialProduct">

    </div>
    <div class="loader">
        <img id="loader_img" src="~/Content/img/loader.gif" style="display: none" />
    </div>


    
</div>

<script src="~/Content/js/jquery-1.9.1.min.js"></script>
<script>
    var PageIndex;
    //$(function () {
    function LoadProducts(ID) {
        var CategoryID = 0;
        //alert('in');
        $("[id*=divPartialProduct]").html("");
        $('#loader_img').show();

        var Id = ID.split('#');
        var ComponentOfferID = Id[1];
        var OfferName = $("[id*=" + ID + "]").closest('tr').find('.OfferName').html();
        var ComponentID = $("[id*=" + ID + "]").closest('tr').find('.hdnComponentId').val();

        PageIndex = 1;
        var PageSize = 10;
        $.ajax({
            url: '@Url.Action("LoadProducts", "ComponentOfferZone")',
            data: { 'ComponentID': ComponentID, 'OfferName': OfferName, 'ComponentOfferID': ComponentOfferID, 'PageIndex': PageIndex, 'PageSize': PageSize, 'CategoryID': CategoryID },
            type: "Post",
            cache: false,
            success: function (data) {

                setTimeout(function () {
                    $("[id$=divPartialProduct]").html(data);
                }, 2000);

                //$("[id*=divPartialProduct]").html(data);

                //alert($("[id*=divPartialProduct]").html());
                setTimeout(function () {
                    BindSavedOffersToProduct(ComponentOfferID);
                }, 2000)

                $('#loader_img').hide();
            },
            error: function (data) {

            }
        });

    }

    function BindSavedOffersToProduct(ComponentOfferID) {
        // alert(OfferID);
        $.ajax({
            url: '@Url.Action("BindSavedOffersToProduct", "ComponentOfferZone")',
            data: { 'ComponentOfferID': ComponentOfferID },
            type: "Post",
            cache: false,
            success: function (data) {
                $.each(data, function (index, item) {
                    $("#tblProduct tr:gt(2)").each(function () {
                        var ShopStockID = $(this).closest('tr').find('.chkApply').val();
                        if (item == ShopStockID) {
                            $(this).closest('tr').find('.chkApply').attr('checked', true);
                        }
                    });
                });

            },
            error: function (data) {

            }
        });
      
    }
</script>
