@model ModelLayer.Models.SEO

@{
    ViewBag.Title = "Create";
}
<div id="content" class="span10">
    <ul class="breadcrumb">
        <li>
            <a href="#">SEO</a>
        </li>
    </ul>
    <div class="row-fluid">
        <div class="box span12">
            <div class="box-header">
                <h2><i class="icon-edit"></i><span class="break"></span>Create</h2>
            </div>
            <div class="box-content">

                @using (Html.BeginForm())
                {
                    @Html.AntiForgeryToken()

                    <div class="form-horizontal">
                        @Html.ValidationSummary(true)
                        @if (ViewBag.ErrorMessage != null)
                        {
                            <div style="color:red; font-weight:bold;">
                                @ViewBag.ErrorMessage
                            </div>
                        }
                        @if (ViewBag.OperationResult != null)
                        { 
                        @Html.Hidden("OperationResult", (string)ViewBag.OperationResult)
                        }
                        <div class="col-md-12 formDiv">
                            <ul>
                                <li class="span4">
                                    @Html.LabelFor(model => model.BusinessTypeID, "BusinessTypeID", new { @class = "control-label col-md-2" })

                                    @Html.DropDownList("BusinessTypeID","Select Businesstype")
                                    @Html.ValidationMessageFor(model => model.BusinessTypeID)

                                </li>
                                <li class="span4">

                                </li>
                            </ul>
                            <div class="clr"></div>

                        </div>
                        <div id="CategoryList">
                            <div class="heading-seo">
                                <h2>Enter Category ID</h2>
                                <span id="OptionMessage"></span>
                                <div>                                    
                                    @Html.TextBox("txtCategoryID", 0, new { @disabled = "disabled" })
                                </div>
                            </div>
                            <div class="heading-seo">
                                <h2>Enter Product ID</h2>
                                <span id="OptionMessage"></span>
                                <div>                                    
                                    @Html.TextBox("txtProductID", 0, new { @disabled = "disabled" })
                                </div>
                            </div>
                            </div>
                            <div id="CategoryList">
                                <div class="heading-seo">
                                    <h2>Select Option</h2>
                                    <span id="OptionMessage"></span>
                                    <div>
                                        @Html.HiddenFor(model => model.EntityID)
                                        @Html.ValidationMessageFor(model => model.EntityID)
                                    </div>
                                </div>
                                <ul class="formDiv">
                                    <li class="span3">
                                        <label>Select LevelOne Category</label>
                                        @Html.RadioButton("EntityType", false, new { @Class = "OneLevelchk" })
                                        @Html.DropDownList("LevelOne", (SelectList)ViewBag.LevelOne, "Select Category")
                                    </li>
                                    <li class="span3">
                                        <label>Select LevelTwo Category</label>
                                        @Html.RadioButton("EntityType", false, new { @Class = "TwoLevelchk" })
                                        @Html.DropDownList("LevelTwo", (SelectList)ViewBag.LevelTwo, "Select Category")
                                    </li>
                                    <li class="span3">
                                        <label>Select LevelThree Category</label>
                                        @Html.RadioButton("EntityType", false, new { @Class = "ThreeLevelchk" })
                                        @Html.DropDownList("LevelThree", (SelectList)ViewBag.LevelThree, "Select Category")
                                    </li>
                                    <li class="span3">
                                        <label>Select Product</label>
                                        @Html.RadioButton("EntityType", false, new { @Class = "Productchk" })
                                        @Html.DropDownList("ProductID", (SelectList)ViewBag.ProductID, "Select Product")
                                    </li>
                                </ul>
                                <div class="clr"></div>
                            </div>
                            <div class="listFor">
                                <div class="form-group">
                                    @Html.LabelFor(model => model.H1, new { @class = "control-label col-md-2" })
                                    <div class="col-md-10">

                                        @Html.EditorFor(model => model.H1)
                                        @Html.ValidationMessageFor(model => model.H1)
                                    </div>
                                </div>

                                <div class="form-group">
                                    @*@Html.LabelFor(model => model.Metatag, new { @class = "control-label col-md-2" })*@
                                    <label class="control-label col-md-2">Page Title </label>
                                    <div class="col-md-10">

                                        @Html.TextAreaFor(model => model.Metatag)
                                        @Html.ValidationMessageFor(model => model.Metatag)
                                    </div>
                                </div>
                               
                                <div class="form-group">
                                    @Html.LabelFor(model => model.MetaKeyword, new { @class = "control-label col-md-2" })
                                    <div class="col-md-10">

                                        @Html.TextAreaFor(model => model.MetaKeyword)
                                        @Html.ValidationMessageFor(model => model.MetaKeyword)
                                    </div>
                                </div>
                                <div class="form-group">
                                    @*@Html.LabelFor(model => model.Description, new { @class = "control-label col-md-2" })*@
                                    <label class="control-label col-md-2">
                                        SEO Description
                                    </label>

                                    <div class="col-md-10">

                                        @Html.TextAreaFor(model => model.Description)
                                        @Html.ValidationMessageFor(model => model.Description)
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="control-label col-md-2">
                                        Product Description
                                    </label>
                                        <div class="col-md-10">
                                            @if (ViewBag.ProductDisription != null)
                                            {
                                                @Html.TextArea("ProductDisription", (string)ViewBag.ProductDisription)
                                            }
                                            else
                                            {
                                                @Html.TextArea("ProductDisription")
                                            }
                                        </div>
</div>

                                <div class="form-group">
                                    @Html.LabelFor(model => model.IsActive, new { @class = "control-label col-md-2" })
                                    <div class="col-md-10">
                                        @Html.CheckBoxFor(model => model.IsActive)
                                        @Html.ValidationMessageFor(model => model.IsActive)
                                    </div>
                                </div>
                            </div>
                            <div class="form-actions">
                                <input type="submit" value="Create" id="SubmitData" class="btn btn-success" />
                                @Html.ActionLink("Back to List", "Index", null, new { @class = "btn" })
                            </div>
                        </div>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}
<script src="~/Content/js/jquery-2.1.3.min.js"></script>

<script>

    function ClearData() {

        $('#txtCategoryID').val('0');
        $('#txtProductID').val('0');

        $('#txtCategoryID').attr("disabled", "disabled");
        $('#txtProductID').attr("disabled", "disabled");
        $('#IsActive').attr("checked", false);

        $("#H1").val('');
        $("#Metatag").val('');
        $("#MetaKeyword").val('');
        $("#Description").val('');
        $("#ProductDisription").val('');

        $(".Productchk").attr("disabled", false);

        $(".OneLevelchk").attr("disabled", false);
        $(".TwoLevelchk").attr("disabled", false);
        $(".ThreeLevelchk").attr("disabled", false);



        $("#ProductID").empty();
        $("#ProductID").append("<option value=0>Select Product</option>");
        $("#LevelThree").empty();
        $("#LevelThree").append("<option value=0>Select Category</option>");
        $("#LevelTwo").empty();
        $("#LevelTwo").append("<option value=0>Select Category</option>");

        $("#LevelOne").val($("#LevelOne option:first").val());

        $("#EntityID").val(null);
        $("#BusinessTypeID").val($("#BusinessTypeID option:first").val());
    }

    $(document).ready(function () {

        var OperationResult = $("#OperationResult").val();
        if (OperationResult == '1') {
            ClearData();
        }
       

        $(".btn-success").click(function () {
            var value = $("#EntityID").val();

            if (value == null || parseInt(value) < 1) {
                $("#OptionMessage").html("Invalid Selection of Option")
                $("#OptionMessage").attr("color", "Red");
                $("#OptionMessage").attr("font-weight", "bold");
            }            

        });
        
        $("#BusinessTypeID").change(function () {
            // $("#CategoryList").attr("display", "none");
            // $("#CategoryList").css("display", "none");

            
            var prefix = $("#BusinessTypeID option:selected").val();

            $.ajax({
                type: "POST",
                url: "/SEOPage/PrefixVerification?id=" + prefix,
                datatype: "Json",
                contentType: "application/json; charset=utf-8",
                success: function (msg) {
                    if (msg == 'MTDT') {
                      
                        $(".OneLevelchk").attr("disabled", true);
                        $(".TwoLevelchk").attr("disabled", true);
                        $(".ThreeLevelchk").attr("disabled", true);
                        $(".Productchk").attr("disabled", false);
                        
                        var id = $("#ProductID option:selected").val();
                        $("#EntityID").val(id);


                        $('#txtCategoryID').attr("disabled", "disabled");
                        $('#txtProductID').attr("disabled", false);

                    }
                    else {
                      
                        $(".Productchk").attr("disabled", true);

                        $(".OneLevelchk").attr("disabled", false);
                        $(".TwoLevelchk").attr("disabled", false);
                        $(".ThreeLevelchk").attr("disabled", false);
                        
                        var id = $("#LevelOne option:selected").val();
                        $("#EntityID").val(id);

                        $('#txtCategoryID').attr("disabled",false);
                        $('#txtProductID').attr("disabled", "disabled");

                    }
                    $("#ProductID").empty();
                    $("#ProductID").append("<option value=0>Select Product</option>");
                    $("#LevelThree").empty();
                    $("#LevelThree").append("<option value=0>Select Category</option>");
                    $("#LevelTwo").empty();
                    $("#LevelTwo").append("<option value=0>Select Category</option>");
                    
                },
                error: function (x, e) {
                    $('#txtCategoryID').attr("disabled", "disabled");
                    $('#txtProductID').attr("disabled", "disabled");
                    ClearData();
                  
                }
            });
        });

        $("#SubmitData").click(function () {
            
            
            var selectedOption = $("#BusinessTypeID option:selected").text();
           
            if (selectedOption == "CategoryMetadata")
            {
                if ($(".OneLevelchk").is(":checked") == false &&
                 $(".TwoLevelchk").is(":checked") == false &&
                $(".ThreeLevelchk").is(":checked") == false) {
                    alert("Please Select One of the Category Option");
                    return false;
                }                
            }
            if (selectedOption == "ProductMetadata") {
                if ($(".Productchk").is(":checked") == false ) {
                    alert("Please Select One of the Product Option");
                    return false;
                }
            }

            //$(".TwoLevelchk").attr("disabled", true);
            //$(".ThreeLevelchk").attr("disabled", true);
            //$(".Productchk").attr("disabled", false);
        });


        
        $("#LevelOne").change(function () {

            var id = $("#LevelOne option:selected").val();
            var check = $("input:radio[name=EntityType]:checked").attr("class");
            if (check == 'OneLevelchk') {
                $("#EntityID").val(id);
            }


            $.ajax({
                type: "POST",
                url: "/SEOPage/CaltegoryList?id=" + id,
                datatype: "JSON",
                success: function (msg) {
                    $("#ProductID").empty();
                    $("#ProductID").append("<option value=0>Select Product</option>");
                    $("#LevelThree").empty();
                    $("#LevelThree").append("<option value=0>Select Category</option>");
                    $("#LevelTwo").empty();
                    $("#LevelTwo").append("<option value=0>Select Category</option>");

                    $.each(msg, function (index, item) {
                        $('#LevelTwo').append('<option value=' + item.ID + '>' + item.Name + '</option>');
                    });
                }
            });
        });

        $("#LevelTwo").change(function () {

            var id = $("#LevelTwo option:selected").val();
            var check = $("input:radio[name=EntityType]:checked").attr("class");
            if (check == 'TwoLevelchk') {
                $("#EntityID").val(id);
            }

            $.ajax({
                type: "POST",
                url: "/SEOPage/CaltegoryList?id=" + id,
                datatype: "JSON",
                success: function (msg) {
                    $("#ProductID").empty();
                    $("#ProductID").append("<option value=0>Select Product</option>");
                    $("#LevelThree").empty();
                    $("#LevelThree").append("<option value=0>Select Category</option>");
                  
                    $.each(msg, function (index, item) {
                        $('#LevelThree').append('<option value=' + item.ID + '>' + item.Name + '</Option>');
                    });

                }
            });

        });

        $("#LevelThree").change(function () {

            var id = $("#LevelThree option:selected").val();
            var check = $("input:radio[name=EntityType]:checked").attr("class");
            if (check == 'ThreeLevelchk') {
                $("#EntityID").val(id);
            }

            $.ajax({
                type: "POST",
                url: "/SEOPage/ProductList?id=" + id,
                datatype: "JSON",
                success: function (msg) {
                    $("#ProductID").empty();
                    $('#ProductID').append('<option value=0>Select Product</Option>');

                    $.each(msg, function (index, item) {
                        $('#ProductID').append('<option value=' + item.ID + '>' + item.Name + '</Option>');
                    });

                }
            });

        });

        $("#ProductID").change(function () {

            var id = $("#ProductID option:selected").val();
            var check = $("input:radio[name=EntityType]:checked").attr("class");
            if (check == 'Productchk') {
                $("#EntityID").val(id);
            }
        });
        
        $("input:radio[name=EntityType]").click(function () {


            var check = $("input:radio[name=EntityType]:checked").attr("class");
            if (check == 'TwoLevelchk') {
                var id = $("#LevelTwo option:selected").val();
                $("#EntityID").val(id);

            }

            if (check == 'ThreeLevelchk') {
                var id = $("#LevelThree option:selected").val();
                $("#EntityID").val(id);
            }

            if (check == 'OneLevelchk') {
                var id = $("#LevelOne option:selected").val();
                $("#EntityID").val(id);
            }
            if (check == 'Productchk') {
                var id = $("#ProductID option:selected").val();
                $("#EntityID").val(id);
            }
        });
        
        $("#txtCategoryID").blur(function (e) {
            var id = $("#txtCategoryID").val();
            $("#LevelOne option:selected").attr("selected", null);
            $("#LevelOne option[value='" + id + "']").attr("selected", "selected");
            var level2Selected=0;
            var level3Selected = 0;
            var level1Selected = 0;
         
            $('#txtProductID').val('0');
            $.ajax({

                type: "POST",
                url: "/SEOPage/SelectedCategory?id=" + id,
                datatype: "JSON",
                success: function (msg) {
                    $("#LevelTwo").empty();
                    $('#LevelTwo').append('<option value=0>Select Category</Option>');
                    $("#LevelThree").empty();
                    $('#LevelThree').append('<option value=0>Select Category</Option>');
                    $("#ProductID").empty();
                    $('#ProductID').append('<option value=0>Select Category</Option>');

                    $.each(msg, function (index, item) {
                        if (item.level == 0) {
                            if (item.selectedID == true) {
                                ProductSelected = item.ID;
                            }

                            $('#ProductID').append('<option value=' + item.ID + '>' + item.Name + '</Option>');

                        }
                        else if (item.level == 2) {
                            if (item.selectedID == true) {
                                level2Selected = item.ID;
                            }
                            
                                $('#LevelTwo').append('<option value=' + item.ID + '>' + item.Name + '</Option>');
                            
                        }
                        else if (item.level == 3) {
                            if (item.selectedID == true) {
                                level3Selected = item.ID;
                            }
                                $('#LevelThree').append('<option value=' + item.ID + '>' + item.Name + '</Option>');                            
                        }
                        else if (item.level == 1) {
                            if (item.selectedID == true) {
                                level1Selected = item.ID;
                            }
                        }
                    });
                    $("#LevelTwo option:selected").attr("selected", null);
                    $("#LevelTwo option[value='" + level2Selected + "']").attr("selected", "selected");

                    $("#LevelThree option:selected").attr("selected", null);
                    $("#LevelThree option[value='" + level3Selected + "']").attr("selected", "selected");

                    $("#LevelOne option:selected").attr("selected", null);
                    $("#LevelOne option[value='" + level1Selected + "']").attr("selected", "selected");
                 
                }

            });

           

        });

        $("#txtProductID").blur(function (e) {
            var id = $("#txtProductID").val();
            //$("#LevelOne option:selected").attr("selected", null);
            //$("#LevelOne option[value='" + id + "']").attr("selected", "selected");
            $('#txtCategoryID').val('0');


            var level2Selected = 0;
            var level3Selected = 0;
            var level1Selected = 0;
            var ProductSelected = 0;
     

            $.ajax({

                type: "POST",
                url: "/SEOPage/SelectedProduct?id=" + id,
                datatype: "JSON",
                success: function (msg) {
                    $("#LevelTwo").empty();
                    $('#LevelTwo').append('<option value=0>Select Category</Option>');
                    $("#LevelThree").empty();
                    $('#LevelThree').append('<option value=0>Select Category</Option>');
                    $("#ProductID").empty();
                    $('#ProductID').append('<option value=0>Select Category</Option>');

                    $.each(msg, function (index, item) {
                        if (item.level == 0) {
                            if (item.selectedID == true) {
                                ProductSelected = item.ID;
                            }

                            $('#ProductID').append('<option value=' + item.ID + '>' + item.Name + '</Option>');

                        }
                       else  if (item.level == 2) {
                            if (item.selectedID == true) {
                                level2Selected = item.ID;
                            }

                            $('#LevelTwo').append('<option value=' + item.ID + '>' + item.Name + '</Option>');

                        }
                        else if (item.level == 3) {
                            if (item.selectedID == true) {
                                level3Selected = item.ID;
                            }
                            $('#LevelThree').append('<option value=' + item.ID + '>' + item.Name + '</Option>');
                        }
                        else if (item.level == 1) {
                            if (item.selectedID == true) {
                                level1Selected = item.ID;
                            }
                        }
                    });
                    $("#LevelTwo option:selected").attr("selected", null);
                    $("#LevelTwo option[value='" + level2Selected + "']").attr("selected", "selected");

                    $("#LevelThree option:selected").attr("selected", null);
                    $("#LevelThree option[value='" + level3Selected + "']").attr("selected", "selected");

                    $("#LevelOne option:selected").attr("selected", null);
                    $("#LevelOne option[value='" + level1Selected + "']").attr("selected", "selected");

                    $("#ProductID option:selected").attr("selected", null);
                    $("#ProductID option[value='" + ProductSelected + "']").attr("selected", "selected");

                }

            });



        });

    });

</script>
