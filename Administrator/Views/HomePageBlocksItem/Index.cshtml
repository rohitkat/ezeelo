@model IEnumerable<ModelLayer.Models.ViewModel.BlockTypeViewModel>
@{
    ViewBag.Title = "Index";
}
<style>
    a {
        text-decoration: underline;
    }
    th div {
        position: inherit !important;
        background: transparent;
        color: #222;
        padding: 1px 10px;
        top: 3px;
        margin-left: -8px;
        line-height: normal;
        /* border-left: 1px solid #DDD; */
        padding-top: 1px !important;
    }
    .container_tbl {
        overflow-y: scroll;
        height: 294px;
        margin-top: 0px !important;
    }
    .section {
        position: relative;
        border: 1px solid #000;
        padding-top: 0px !important;
        margin-left: 5px;
        margin-top: 2px;
        background: #fff;
    }
    .CategoryDiv {
        width: 233px;
        float: left;
        padding: 10px;
    }

        .CategoryDiv span {
            display: block;
            font-size: 15px;
            font-weight: 600;
        }

        .CategoryDiv select {
            display: block;
        }

    .textDiv {
        margin-left: 10px;
        width: 100%;
        float: left;
    }

    #Content {
    }
</style>

<div id="content" class="span10">
    <ul class="breadcrumb">
        <li>
            <a href="#">Index</a>
        </li>
    </ul>
    @using (Html.BeginForm())
    {
        @Html.Hidden("BlockTypeID", (long)@ViewBag.BlockTypeID)
        <div class="row-fluid">
            <div class="box span12">
                <div class="box-header">
                    <h2><i class="icon-edit"></i><span class="break"></span>@Html.ActionLink("Create New", "Create")</h2>
                    <div class="pull-right jumpBtn">
                        @Html.ActionLink("Set Sequence", "SetSequence", null, new { @class = "btn  btn-primary btn-small" })
                    </div>

                </div>
                <div class="box-content">
                    <div style="width:100%;">
                        @if (TempData["Message"] != null)
                        {
                            <br />
                            <span style="font-weight:bold; color:red;"> @TempData["Message"]  </span>
                        }
                    </div>
                    <div class="CategoryDiv">
                        <span>Select Franchise</span>
                        @Html.DropDownList("FranchiseList", null, "Select Franchise", new { @style = "width:auto;", onchange = "clearBlockType();" })
                    </div>
                    <div class="CategoryDiv">
                        <span>Select Start Date</span>
                        <input type="text" id="SDate" name="SDate" value="@ViewBag.SDate" class="datepicker" />
                        <span id="SDateErro" style="font-weight:bold;color:red;"></span>
                    </div>
                    <div class="CategoryDiv">
                        <span>Select End Date</span>
                        <input type="text" id="EDate" name="EDate" value="@ViewBag.EDate" class="datepicker" />
                        <span id="EDateErro" style="font-weight:bold;color:red;"></span>
                    </div>
                    <div class="CategoryDiv">
                        <input type="submit" value="Search" class="btn btn-success" style="margin-top: 19px" />
                    </div>
                    
                        <span id="DateErro" style="font-weight:bold;color:red;"></span>
                        <div class="clr"></div>

                        @if (Model != null)
        {
                            <table class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                        <th>
                                            Block Type Name
                                        </th>
                                        <th>
                                            Items Count
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model)
                    {
                        if (item.ItemCount > 0)
                        {
                            <tr>
                                <td><a onclick="GetItemListing(@item.ID);">@item.Name</a></td>
                                <td>@Html.DisplayFor(modelItem => item.ItemCount)</td>
                            </tr>
                                        <tr>
                                            <td colspan="2"><div id="@item.ID" style="display:none;"></div></td>
                                        </tr>
                        }
                    }
                                </tbody>
                            </table>
        }

                    </div>
            </div>
        </div>
    }
</div>


<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script>
    $(document).ready(function () {

        if ($("[id*=BlockTypeID").val() != 0) {

            var BlockTypeID = $("[id*=BlockTypeID").val();
            var FranchiseID = $("#FranchiseList option:selected").val();
            var SDate = $("#SDate").val();
            var EDate = $("#EDate").val();
            /*Check Condition*/
            $('#' + BlockTypeID).html(null);
            $('#' + BlockTypeID).toggle();

            /*Processing Image*/
            $("#pageloaddiv").css('display', 'block');
            $("#pageloaddiv").fadeOut(1000);


            /* Request the partial view with .get request. */
            $.get('/HomePageBlocksItem/ItemListing?FranchiseID=' + FranchiseID + '&BlockTypeID=' + BlockTypeID + '&SDate=' + SDate + '&EDate=' + EDate, function (data) {
                /* data is the pure html returned from action method, load it to your page */
                $('#' + BlockTypeID).html(data);

            });

            $("#pageloaddiv").css('display', 'none');
            $("#pageloaddiv").fadeOut(1000);


        }
    });

    function clearBlockType() {
        $("[id*=BlockTypeID").val(0);
    }

    function GetItemListing(selectedID) {
        /* Get the selected value of dropdownlist */
        $("[id*=BlockTypeID").val(0);
        var FranchiseID = $("#FranchiseList option:selected").val();
        var SDate = $("#SDate").val();
        var EDate = $("#EDate").val();
        /*Check Condition*/
        $('#' + selectedID).html(null);
        $('#' + selectedID).toggle();

        /*Processing Image*/
        $("#pageloaddiv").css('display', 'block');
        $("#pageloaddiv").fadeOut(1000);


        /* Request the partial view with .get request. */
        $.get('/HomePageBlocksItem/ItemListing?FranchiseID=' + FranchiseID + '&BlockTypeID=' + selectedID+ '&SDate=' + SDate + '&EDate=' + EDate, function (data) {
            /* data is the pure html returned from action method, load it to your page */
            $('#' + selectedID).html(data);

        });

        $("#pageloaddiv").css('display', 'none');
        $("#pageloaddiv").fadeOut(1000);

    }

</script>
