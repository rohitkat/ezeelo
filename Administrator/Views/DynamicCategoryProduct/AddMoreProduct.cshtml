@model ModelLayer.Models.DynamicCategoryProduct
@{
    ViewBag.Title = "AddMoreProduct";
}
<style>
    .CategoryDiv {
        width: 233px;
        float: left;
        padding: 10px;
    }

        .CategoryDiv span {
            display: block;
            font-size: 15px;
            font-weight: 600;
        }

        .CategoryDiv label {
            display: block;
            font-size: 15px;
            font-weight: 600;
            text-align: left !important;
        }

        .CategoryDiv select {
            display: block;
        }

    .form-horizontal .form-actions {
        padding-left: 10px !important;
    }

    .textDiv {
        margin-left: 10px;
        width: 100%;
        float: left;
    }

    #Content {
    }

    .uploader {
        width: 195px !important;
    }

    .action {
        border: 1px solid#ccc;
        color: #fff;
        background-color: #2271D2;
        text-shadow: none !important;
        cursor: pointer !important;
    }

    div.uploader span.filename {
        border-right: none;
    }

    #dvPreview {
        /*float: left;*/
        width: 120px;
    }

    .uploader {
        margin-top: 35px;
    }

    #dvPreview img {
        border: 3px solid#CEC4C4;
        margin-bottom: 10px;
        height: 124px;
    }

    div.uploader {
        left: -12px;
        top: 121px;
    }

    .top_cat {
        margin-top: 2px; /*margin-bottom:45px;*/
        border: 1px solid #ccc;
        width: 173px;
        height: 135px;
    }

    #dvPreview {
        margin-top: -60px;
        width: 164px;
        padding: 0px 1px;
    }

    .beatpicker-clear {
        display: none;
    }

    #pageloaddiv {
        position: fixed;
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
        z-index: 1000;
        background: url('../Content/Images/ajax_loader.gif') no-repeat center center;
        background-size: 100px;
        display: none;
    }
</style>

<div id="content" class="span10">
    <ul class="breadcrumb">
        <li>
            <a href="#">Edit</a>
        </li>
    </ul>

    <div class="row-fluid">

        <div class="box span12">
            <div class="box-header">
                <h2><i class="icon-edit"></i><span class="break"></span>Dynamic Category Product</h2>
            </div>
             @using (Html.BeginForm("AddMoreProduct", "DynamicCategoryProduct", null, FormMethod.Post))
            {
                @Html.AntiForgeryToken()
                @Html.Hidden("FranchiseList")

                <div class="box span6 gridBox">
                    <div class="box-content">                       
                        <div class="form-horizontal">
                            @Html.ValidationSummary(true)

                            <div class="CategoryDiv span6">
                                <span>Select Category</span>
                                @Html.DropDownList("CategoryList", "Select Category")
                              
                            </div>
                            <div class="CategoryDiv span6" style="margin-left:-11px;">
                                <span>Select Level Two Category</span>
                                @Html.DropDownList("LevelTwoCategoryList", "Select Category")
                            </div>
                            <div class="CategoryDiv span6" style="margin-left:-11px;">
                                <span>Select Level Three Category</span>
                                @Html.DropDownList("LevelThreeCategoryList", "Select Category")
                                <span id="CategoryErro" style="font-weight:bold;color:red;"></span>
                            </div>
                            <div class="clr"></div>
                          
                            <div id="pageloaddiv"></div>
                            <div id="divSpecification"></div>

                        </div>
                    </div>
                </div>
                <div class="box span6 gridBox">
                    <div class="box-content">
                        <div class="span12">
                            <div class="">
                                 <span id="pMessage"> </span>
                            </div>
                            <div class="clr"></div>
                            <div class="CategoryDiv span6" style="margin-left:-11px;">
                                <span>Select Start Date</span>
                                @*@Html.TextBox("SDate", null, new { @class = "input" })*@
                                <div class="">
                                    <input type="text" id="SDate" name="SDate" value="@ViewBag.SDate" class="datepicker" />
                                    @Html.ValidationMessageFor(model => model.StartDate)
                                </div>
                                <span id="SDateErro" style="font-weight:bold;color:red;"></span>
                            </div>
                            <div class="CategoryDiv span6">
                                <span>Select End Date</span>
                                @*@Html.TextBox("EDate", null, new { @class = "input" })*@
                                <input type="text" id="EDate" name="EDate" value="@ViewBag.EDate" class="datepicker" />
                                @Html.ValidationMessageFor(model => model.EndDate)
                                <span id="EDateErro" style="font-weight:bold;color:red;"></span>
                            </div>
                            <span id="DateErro" style="font-weight:bold;color:red;"></span>
                            <div class="span12" >
                                <a id="btnView" class="btn btn-primary" onclick="GetAddedProducts(@ViewBag.FranchiseList);">View Added Products</a>
                            </div>
                            <div class="span12" style="margin-top:10px;">
                                <input id="btnSubmit" type="submit" name="btnSubmit" class="btn btn-success" style="float: left;" />
                                @if (ViewBag.Message != null)
                                {
                                    <div style="font-weight: bold; color: red; float: left; margin: 5px 5px;">@ViewBag.Message</div>
                                }
                            </div>
                        </div>
                        <div class="span12 gridBox2" style="overflow-y:scroll; height:550px;">
                            <span id="ProdErro" style="font-weight:bold;color:red;"></span>
                            <table class="table table-striped table-bordered" id="thirdLevelCategory">
                                <thead>
                                    <tr>
                                        <th>
                                            ID
                                        </th>
                                        <th>
                                            Name
                                        </th>
                                        <th></th>
                                    </tr>
                                </thead>
                            </table>

                            <input type="hidden" name="CaltegoryList" id="CaltegoryList">

                        </div>

                    </div>
                </div>
            }

            <div class="form-actions" style="clear:both;">
                @Html.ActionLink("Back to Franchise List", "Index", null, new { @class = "btn btn-brown" })
            </div>
        </div>
        @* }*@
    </div>
</div>
    <script src="~/Scripts/jquery-1.10.2.min.js"></script>


    <script>

        $(document).ready(function () {

            $(".btn-success").click(function () {
                var ErrorCount = 0;
                var LevelOne = $("#CategoryList option:selected").text();
                var LevelTwo = $("#LevelTwoCategoryList option:selected").text();
                var LevelThree = $("#LevelThreeCategoryList option:selected").text();
                var startate = $("#SDate").val();
                var endDate = $("#EDate").val();
                var productList = ($("#thirdLevelCategory tr").length)-1;
                
                if (LevelOne == 'Select Category' || LevelTwo == 'Select Category' || LevelThree == 'Select Category') {
                    $('#CategoryErro').html('Please Select All Categories');
                    ErrorCount = ErrorCount + 1;
                }
                else {
                    $('#CategoryErro').html('');
                }
                if (startate == '') {
                    $('#SDateErro').html('Please Select Start Date');
                    ErrorCount = ErrorCount + 1;
                }
                else {
                    $('#SDateErro').html('');
                }
                if (endDate == '') {
                    $("#EDateErro").html('Please Select End Date');
                    ErrorCount = ErrorCount + 1;
                }
                else {
                    $("#EDateErro").html('');
                }
                if (productList == 0) {
                    $("#ProdErro").html('Please Add Product');
                    ErrorCount = ErrorCount + 1;
                }
                else {
                    $("#ProdErro").html('');
                }                

                if (startate != '' && endDate != '') {

                    var sdate = startate.split("/");   //date present in dd/MM/yyyy format
                    var edate = endDate.split("/");    //date present in dd/MM/yyyy format

                    if (new Date(sdate[2], sdate[1], sdate[0]) > new Date(edate[2], edate[1], edate[0])) {     //date in yyyy mm dd format
                        $("#DateErro").html('Please Select Start Date Less than End Date');
                        ErrorCount = ErrorCount + 1;
                    }
                    else {
                        $("#DateErro").html('');
                    }
                }

                if (ErrorCount > 0) {
                    return false;
                }
            });

            $("#CategoryList").change(function () {
                /* Get the selected value of dropdownlist */
                var selectedID = $(this).val();
                var FranchiseID = $("[id=FranchiseList]").val();
                var level = 1;


                /*Processing Image*/
                $("#pageloaddiv").css('display', 'block');
                $("#pageloaddiv").fadeOut(1000);


                $.ajax({
                    type: "POST",
                    url: "/DynamicCategoryProduct/SelectCategory?ParentCategory=" + selectedID + "&level=2",
                    //url: "/ShopPriority/ParentCategory",
                    //data: "{ ParentCategory: " + id + ",level:"+ 2 +"}",
                    dataType: "json",
                    async: true,
                    cache: false,
                    success: function (msg) {
                        $('#LevelTwoCategoryList').empty();
                        $('#LevelTwoCategoryList').append('<option value=0>Select Category</option>');
                        $.each(msg, function (index, item) {
                            $('#LevelTwoCategoryList').append('<option value=' + item.ID + '>' + item.Name + '</option>');
                        });
                        $("#pageloaddiv").css('display', 'none');
                        $("#pageloaddiv").fadeOut(1000);
                    },
                    error: function (x, e) {
                        alert("Sorry No Such Type of Category Is available. ");
                        $("#pageloaddiv").css('display', 'none');
                        $("#pageloaddiv").fadeOut(1000);
                    }
                });
            });

            $("#LevelTwoCategoryList").change(function () {
                /* Get the selected value of dropdownlist */
                var selectedID = $(this).val();
                var FranchiseID = $("[id=FranchiseList]").val();
                var level = 2;

                /*Processing Image*/
                $("#pageloaddiv").css('display', 'block');
                $("#pageloaddiv").fadeOut(1000);


                $.ajax({
                    type: "POST",
                    url: "/DynamicCategoryProduct/SelectCategory/?ParentCategory=" + selectedID + "&level=3",
                    //url: "/ShopPriority/ParentCategory",
                    //data: "{ ParentCategory: " + id + ",level:"+ 2 +"}",
                    dataType: "json",
                    async: true,
                    cache: false,
                    success: function (msg) {

                        $('#LevelThreeCategoryList').empty();
                        $('#LevelThreeCategoryList').append('<option value=0>Select Category</option>');
                        $.each(msg, function (index, item) {
                            $('#LevelThreeCategoryList').append('<option value=' + item.ID + '>' + item.Name + '</option>');
                        });
                        $("#pageloaddiv").css('display', 'none');
                        $("#pageloaddiv").fadeOut(1000);
                    },
                    error: function (x, e) {

                        alert("Sorry No Such Type of Category Is available. ");
                        $("#pageloaddiv").css('display', 'none');
                        $("#pageloaddiv").fadeOut(1000);
                    }
                });
            });

            $("#LevelThreeCategoryList").change(function () {
                /* Get the selected value of dropdownlist */
                var selectedID = $(this).val();
                var FranchiseID = $("[id=FranchiseList]").val();
                var level = 3;
                /*Check Condition*/
                $('#divSpecification').html(null);

                /*Processing Image*/
                $("#pageloaddiv").css('display', 'block');
                $("#pageloaddiv").fadeOut(1000);

                /* Request the partial view with .get request. */
                //$.get('/ShopPriority/ShopPriorityList/?FranchiseList=' + FranchiseID + '&CategoryList=' + selectedID, function (data) {
                $.post('/DynamicCategoryProduct/GetProductList/?FranchiseID=' + FranchiseID + '&CategoryID=' + selectedID, function (data) {
                    /* data is the pure html returned from action method, load it to your page */
                    $('#divSpecification').html(data);

                    /* little fade in effect */
                    $('#divSpecification').fadeIn('fast');
                });

                //$("#tableSimilarProduct .btnAdd").click(function () {
                //    $(this).parent().parent().css('background-color', '#c4eccc');
                //    /*Disable Add Button*/
                //    $(this).css('pointer-events', 'none');
                //    $(this).css('cursor', 'default');
                //});

                $("#pageloaddiv").css('display', 'none');
                $("#pageloaddiv").fadeOut(1000);

            });
        });

        function GetAddedProducts(franchiseId) {

            var sDate = $("#SDate").val();
            var eDate = $("#EDate").val();

            if (sDate != '' && eDate != '') {

                /*Processing Image*/
                $("#pageloaddiv").css('display', 'block');
                $("#pageloaddiv").fadeOut(1000);

                $.ajax({
                    type: "POST",
                    url: "/DynamicCategoryProduct/GetAddedProducts?FranchiseID=" + franchiseId + "&SDate=" + sDate + "&EDate=" + eDate,
                    //data: "{ ParentCategory: " + id + ",level:"+ 2 +"}",
                    dataType: "json",
                    async: true,
                    cache: false,
                    success: function (msg) {
                        $('#thirdLevelCategory tbody').empty();
                        $.each(msg, function (index, item) {
                            $("#thirdLevelCategory").append("<tr>" +
                                "<td>" + item.ID + "</td>" +
                                "<td>" + item.Name + "</td>" +
                                 "<td>" +
                                 "</td> </tr>"

                            );
                            count = count + 1;
                        });
                        //$("#tableSimilarProduct .btnAdd").click(function () {
                        //    $(this).parent().parent().css('background-color', '#c4eccc');
                        //});
                        $("#pageloaddiv").css('display', 'none');
                        $("#pageloaddiv").fadeOut(1000);
                    },
                    error: function (x, e) {
                        alert("Sorry No Such Type of Category Is available. ");
                        $("#pageloaddiv").css('display', 'none');
                        $("#pageloaddiv").fadeOut(1000);
                    }
                });
            }
            else {
                alert("Please select start date & end date !!");
            }
        }

        var CategoryIDList = [];
        var count = 1;

        function AddRowToTable(id) {
            /* To set color of added row*/
            $("[id*=" + id + "]").css('background-color', '#c4eccc');
            /*Disable Add Button*/
            $("[id*=" + id + "]").css('pointer-events', 'none');
            $("[id*=" + id + "]").css('cursor', 'default');

            var tRow = $("[id*=" + id + "]").html();
            $("#thirdLevelCategory tr:first").after("<tr>" + tRow + "</tr>");
           // $("[id*=thirdLevelCategory]").append("<tr>" + tRow + "</tr>");
            $("#thirdLevelCategory tr td a").replaceWith("<a href='#noname'>Remove</a>");
            CategoryIDList.push(id);
            $("[id*=CaltegoryList]").val(CategoryIDList);

            $("#thirdLevelCategory tr td a").click(function () {
                $(this).parent().parent().remove();
                var cid = $(this).parent().parent().children("td:first").html();

                CategoryIDList.splice(CategoryIDList.indexOf(parseInt(cid)), 1);

                $("[id*=CaltegoryList]").val(CategoryIDList);

                //alert(CategoryIDList.indexOf(parseInt(cid)));

                $("[id*=" + cid + "]").css("background-color", "white");
                /*Enable Add Button*/
                $("[id*=" + cid + "]").css('pointer-events', 'auto');
                $("[id*=" + cid + "]").css('cursor', 'pointer');
            });
        }


        //$("#AddAll").click(function () {
        //    alert('hi');
        //    alert($("#tableSimilarProduct").html());
        //    var data;
        //    // var aa = $('#tableSimilarProduct').html();
        //    //Manage Add or Remove Element from Category table to Plan Tabe
        //    $("#tableSimilarProduct tr").each(function (i, v) {
        //        var id = $(this).attr('id');
        //        //Find the Element in the Added Table which is to be added into the in Plan Talbe
        //        var tableRowCheck = $("#thirdLevelCategory").find("#" + id).html();
        //        //Add Row into the variable with required id setting
        //        var tableRowActual = "<tr id='" + id + "'>" + $("[id*=tableSimilarProduct]").find("#" + id).html() + "</tr>";
        //        // alert(tableRowActual);
        //        //check wether element is exists in Plan table which is to be added (add only if the element is not found in the plan table)
        //        if (typeof (tableRowCheck) == "undefined") {
        //            //add to the Plan Table
        //            $('#thirdLevelCategory').append(tableRowActual);

        //            // $('#thirdLevelCategory').append(aa);
        //            $('#thirdLevelCategory tbody th').parent().remove();
        //            //Replace ADD button to REMOVE button
        //            $("#thirdLevelCategory tr td a").replaceWith("<a href='#noname'>Remove</a>");

        //            $("#thirdLevelCategory a").click(function () {
        //                $(this).parent().parent().remove();
        //                var cid = $(this).parent().parent().children("td:first").html();
        //                //Remove element from the array List
        //                CategoryIDList.splice(CategoryIDList.indexOf(cid), 1);

        //                $("[id*=CaltegoryList]").val(CategoryIDList);
        //                //alert(cid);
        //                $("[id*=tableSimilarProduct]").find("#" + cid).css("background-color", "white");
        //                /*Enable Add Button*/
        //                $("#tableSimilarProduct tr td a").css('pointer-events', 'auto');
        //                $("#tableSimilarProduct tr td a").css('cursor', 'pointer');

        //            });
        //        }
        //    });

        //    //Manage Add or Remove element in Array List
        //    var header = Array();
        //    var id;
        //    $("#tableSimilarProduct tr").each(function (i, v) {
        //        id = $(this).attr('id');

        //        var check = CategoryIDList.indexOf(id)
        //        //alert(CategoryIDList.indexOf(id));
        //        if (parseInt(id) > 0 && check < 0) {
        //            //insert element in to the array List
        //            CategoryIDList.push(id);
        //            $("[id*=CaltegoryList]").val(CategoryIDList);

        //            //Change color of the Add row in table Chategorytable
        //            $("#tableSimilarProduct tr").children('td').parent().css('background-color', '#c4eccc');
        //            /*Disable Add Button*/
        //            $("#tableSimilarProduct tr td a").css('pointer-events', 'none');
        //            $("#tableSimilarProduct tr td a").css('cursor', 'default');
        //        }

        //    });
        //});
    </script>



