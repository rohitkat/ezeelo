@model ModelLayer.Models.DynamicCategoryProduct
@{
    ViewBag.Title = "Create";
}
<style>
    .CategoryDiv {
        width: 233px;
        float: left;
        padding: 10px;
    }

        .CategoryDiv span {
            display: block;
            font-size: 15px;
            font-weight: 600;
        }

        .CategoryDiv label {
            display: block;
            font-size: 15px;
            font-weight: 600;
            text-align: left !important;
        }

        .CategoryDiv select {
            display: block;
        }

    .form-horizontal .form-actions {
        padding-left: 10px !important;
    }

    .textDiv {
        margin-left: 10px;
        width: 100%;
        float: left;
    }

    #Content {
    }

    .uploader {
        width: 195px !important;
    }

    .action {
        border: 1px solid#ccc;
        color: #fff;
        background-color: #2271D2;
        text-shadow: none !important;
        cursor: pointer !important;
    }

    div.uploader span.filename {
        border-right: none;
    }

    #dvPreview {
        /*float: left;*/
        width: 120px;
    }

    .uploader {
        margin-top: 35px;
    }

    #dvPreview img {
        border: 3px solid#CEC4C4;
        margin-bottom: 10px;
        height: 124px;
    }

    div.uploader {
        left: -12px;
        top: 121px;
    }

    .top_cat {
        margin-top: 2px; /*margin-bottom:45px;*/
        border: 1px solid #ccc;
        width: 173px;
        height: 135px;
    }

    #dvPreview {
        margin-top: -60px;
        width: 164px;
        padding: 0px 1px;
    }

    .beatpicker-clear {
        display: none;
    }

    #pageloaddiv {
        position: fixed;
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
        z-index: 1000;
        background: url('../Content/Images/ajax_loader.gif') no-repeat center center;
        background-size: 100px;
        display: none;
    }

    .gridBox2 {
        background: #EEE;
        border: 1px solid #E4E5E6;
    }
    .clear {clear:both;
    }
    #myTable_wrapper {max-height:439px;
    }
</style>

<div id="content" class="span10">
    <ul class="breadcrumb">
        <li>
            <a href="#">Create</a>
        </li>
    </ul>

    <div class="row-fluid">
          <div class="box span12">
            <div class="box-header">
                <h2><i class="icon-edit"></i><span class="break"></span>Dynamic Category Product</h2>
            </div>
            <div class="box-content">
                @using (Html.BeginForm("Create", "DynamicCategoryProduct", null, FormMethod.Post))
                {
                    @Html.AntiForgeryToken()

                    <div class="box span6 gridBox" style="height:193px;">

                        @if (ViewBag.Messaage != null)
                        {
                            <div style="font-weight:bold; color:red;">@ViewBag.Messaage</div>
                        }
                        <div class="form-horizontal ">

                            @Html.ValidationSummary(true)

                            <div class="CategoryDiv span6">
                                <span>Select Franchise</span>
                                @Html.DropDownList("FranchiseList", "Select Franchise")
                                <span id="FranchiseListErro" style="font-weight:bold;color:red;"></span>
                            </div>

                            <div class="CategoryDiv span6">
                                <span>Select Category</span>
                                @Html.DropDownList("CategoryList", "Select Category")
                                <span id="CategoryErro" style="font-weight:bold;color:red;"></span>
                            </div>

                            <div class="CategoryDiv span6" style="margin-left:-2px;">
                                <span>Select Level Two Category</span>
                                @Html.DropDownList("LevelTwoCategoryList", "Select Category")
                            </div>
                            <div class="CategoryDiv span6 ">
                                <span>Select Level Three Category</span>
                                @Html.DropDownList("LevelThreeCategoryList", "Select Category")
                            </div>

                            <div class="clear"></div>

                            
                                <div id="divSpecification" class="clearfix"></div>
                              
                                <div id="pageloaddiv"></div>

                              
                            </div>
                    </div>

                    <div class="box span6 gridBox">
                        <div class="box-content">
                            <div class="span12">
                                <div class="">
                                    <span id="pMessage"> </span>
                                </div>
                                <div class="CategoryDiv span6" style="margin-left:-11px;">
                                    <span>Select Start Date</span>
                                    @*@Html.TextBox("SDate", null, new { @class = "input" })*@
                                    <input type="text" id="SDate" name="SDate" value="@ViewBag.SDate" class="datepicker" />
                                    @Html.ValidationMessageFor(model => model.StartDate)
                                    <span id="SDateErro" style="font-weight:bold;color:red;"></span>
                                </div>
                                <div class="CategoryDiv span6">
                                    <span>Select End Date</span>
                                    @*@Html.TextBox("EDate", null, new { @class = "input" })*@
                                    <input type="text" id="EDate" name="EDate" value="@ViewBag.EDate" class="datepicker" />
                                    @Html.ValidationMessageFor(model => model.EndDate)
                                    <span id="EDateErro" style="font-weight:bold;color:red;"></span>
                                </div>
                                <span id="DateErro" style="font-weight:bold;color:red;"></span>
                                <div class="clr"></div>
                                <div class="span6">
                                    <input id="btnSubmit" type="submit" name="btnSubmit" class="btn btn-success" />
                                </div>
                            </div>

                            <div class="span12 gridBox2" style="overflow-y:scroll; height:550px;">
                                <span id="ProdErro" style="font-weight:bold;color:red;"></span>
                                <table class="table table-bordered" id="thirdLevelCategory">
                                    <thead>
                                        <tr>
                                            <th>
                                                ID
                                            </th>
                                            <th>
                                                Name
                                            </th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                </table>
                                <input type="hidden" name="CaltegoryList" id="CaltegoryList">
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
   
</div>
<div class="form-actions" style="clear:both;">
    @Html.ActionLink("Back to Franchise List", "Index", null, new { @class = "btn btn-brown" })
</div>
<script src="~/Content/js/jquery-1.11.1.min.js"></script>

<script>

    $(document).ready(function () {

        $(".btn-success").click(function () {
            var ErrorCount = 0;
            var franchise = $("#FranchiseList option:selected").text();
            var LevelOne = $("#CategoryList option:selected").text();
            var LevelTwo = $("#LevelTwoCategoryList option:selected").text();
            var LevelThree = $("#LevelThreeCategoryList option:selected").text();
            var startate = $("#SDate").val();
            var endDate = $("#EDate").val();
            var productList = $("#thirdLevelCategory tbody tr").length;

            if (franchise == 'Select Franchise') {
                $('#FranchiseListErro').html('Please Select Franchise');
                ErrorCount = ErrorCount + 1;
            }
            else {
                $('#FranchiseListErro').html('');
            }

            if (LevelOne == 'Select Category' || LevelTwo == 'Select Category' || LevelThree == 'Select Category') {
                $('#CategoryErro').html('Please Select All Categories');
                ErrorCount = ErrorCount + 1;
            }
            else {
                $('#CategoryErro').html('');
            }
            if (startate == '') {
                $('#SDateErro').html('Please Select Start Date');
                ErrorCount = ErrorCount + 1;
            }
            else {
                $('#SDateErro').html('');
            }
            if (endDate == '') {
                $("#EDateErro").html('Please Select End Date');
                ErrorCount = ErrorCount + 1;
            }
            else {
                $("#EDateErro").html('');
            }
            if (productList == 0) {
                $("#ProdErro").html('Please Add Product');
                ErrorCount = ErrorCount + 1;
            }
            else {
                $("#ProdErro").html('');
            }

            if (startate != '' && endDate != '') {

                var sdate = startate.split("/");   //date present in dd/MM/yyyy format
                var edate = endDate.split("/");    //date present in dd/MM/yyyy format

                if (new Date(sdate[2], sdate[1], sdate[0]) > new Date(edate[2], edate[1], edate[0])) {     //date in yyyy mm dd format
                    $("#DateErro").html('Please Select Start Date Less than End Date');
                    ErrorCount = ErrorCount + 1;
                }
                else {
                    $("#DateErro").html('');
                }
            }

            if (ErrorCount > 0) {
                return false;
            }
        });


        $('#FranchiseList').change(function (e) {
            var id = $("#FranchiseList  option:selected").val();
            $("#pageloaddiv").css('display', 'block');
            $("#pageloaddiv").fadeOut(1000);
            $.ajax({
                type: "POST",
                //URL: "/ShopPriority/SelectLevelOneCategoryByFranchise?id=" + id,
                url: "/DynamicCategoryProduct/SelectLevelOneCategoryByFranchise",
                data: "{ id: " + id + "}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: true,
                cache: false,
                success: function (msg) {

                    $('#CategoryList').empty();
                    $('#CategoryList').append('<option value=0>Select Category</option>');

                    $.each(msg, function (index, item) {

                        $('#CategoryList').append('<option value=' + item.ID + '>' + item.Name + '</option>');
                    });
                    $("#pageloaddiv").css('display', 'none');
                    $("#pageloaddiv").fadeOut(1000);
                },
                error: function (x, e) {
                    alert("unable to Retrive Data No ");
                    $("#pageloaddiv").css('display', 'none');
                    $("#pageloaddiv").fadeOut(1000);
                }

            });
        });


        $("#CategoryList").change(function () {
            /* Get the selected value of dropdownlist */
            var selectedID = $(this).val();
            var FranchiseID = $("#FranchiseList option:selected").val();
            var level = 1;


            /*Processing Image*/
            $("#pageloaddiv").css('display', 'block');
            $("#pageloaddiv").fadeOut(1000);


            $.ajax({
                type: "POST",
                url: "/DynamicCategoryProduct/SelectCategory?ParentCategory=" + selectedID + "&level=2",
                //url: "/ShopPriority/ParentCategory",
                //data: "{ ParentCategory: " + id + ",level:"+ 2 +"}",
                dataType: "json",
                async: true,
                cache: false,
                success: function (msg) {
                    $('#LevelTwoCategoryList').empty();
                    $('#LevelTwoCategoryList').append('<option value=0>Select Category</option>');
                    $.each(msg, function (index, item) {
                        $('#LevelTwoCategoryList').append('<option value=' + item.ID + '>' + item.Name + '</option>');
                    });
                    $("#pageloaddiv").css('display', 'none');
                    $("#pageloaddiv").fadeOut(1000);
                },
                error: function (x, e) {
                    alert("Sorry No Such Type of Category Is available. ");
                    $("#pageloaddiv").css('display', 'none');
                    $("#pageloaddiv").fadeOut(1000);
                }
            });
        });

        $("#LevelTwoCategoryList").change(function () {
            /* Get the selected value of dropdownlist */
            var selectedID = $(this).val();
            var FranchiseID = $("#FranchiseList option:selected").val();
            var level = 2;

            /*Processing Image*/
            $("#pageloaddiv").css('display', 'block');
            $("#pageloaddiv").fadeOut(1000);


            $.ajax({
                type: "POST",
                url: "/DynamicCategoryProduct/SelectCategory/?ParentCategory=" + selectedID + "&level=3",
                //url: "/ShopPriority/ParentCategory",
                //data: "{ ParentCategory: " + id + ",level:"+ 2 +"}",
                dataType: "json",
                async: true,
                cache: false,
                success: function (msg) {

                    $('#LevelThreeCategoryList').empty();
                    $('#LevelThreeCategoryList').append('<option value=0>Select Category</option>');
                    $.each(msg, function (index, item) {
                        $('#LevelThreeCategoryList').append('<option value=' + item.ID + '>' + item.Name + '</option>');
                    });
                    $("#pageloaddiv").css('display', 'none');
                    $("#pageloaddiv").fadeOut(1000);
                },
                error: function (x, e) {

                    alert("Sorry No Such Type of Category Is available. ");
                    $("#pageloaddiv").css('display', 'none');
                    $("#pageloaddiv").fadeOut(1000);
                }
            });
        });

        $("#LevelThreeCategoryList").change(function () {
            /* Get the selected value of dropdownlist */
            var selectedID = $(this).val();
            var FranchiseID = $("#FranchiseList option:selected").val();
            var level = 3;
            /*Check Condition*/
            $('#divSpecification').html(null);

            /*Processing Image*/
            $("#pageloaddiv").css('display', 'block');
            $("#pageloaddiv").fadeOut(1000);

            /* Request the partial view with .get request. */
            //$.get('/ShopPriority/ShopPriorityList/?FranchiseList=' + FranchiseID + '&CategoryList=' + selectedID, function (data) {
            $.post('/DynamicCategoryProduct/GetProductList/?FranchiseID=' + FranchiseID + '&CategoryID=' + selectedID, function (data) {
                /* data is the pure html returned from action method, load it to your page */
                $('#divSpecification').html(data);

                /* little fade in effect */
                $('#divSpecification').fadeIn('fast');
            });

            //$("#tableSimilarProduct .btnAdd").click(function () {
            //    $(this).parent().parent().css('background-color', '#c4eccc');
            //    /*Disable Add Button*/
            //    $(this).css('pointer-events', 'none');
            //    $(this).css('cursor', 'default');
            //});

            $("#pageloaddiv").css('display', 'none');
            $("#pageloaddiv").fadeOut(1000);

        });

    });

    var CategoryIDList = [];
    var count = 1;

    function AddRowToTable(id) {
        /* To set color of added row*/
        $("[id*=" + id + "]").css('background-color', '#c4eccc');
        /*Disable Add Button*/
        $("[id*=" + id + "]").css('pointer-events', 'none');
        $("[id*=" + id + "]").css('cursor', 'default');

        var tRow = $("[id*=" + id + "]").html();
        $("[id*=thirdLevelCategory]").append("<tr>" + tRow + "</tr>");
        $("#thirdLevelCategory tr td a").replaceWith("<a href='#noname'>Remove</a>");
        CategoryIDList.push(id);
        $("[id*=CaltegoryList]").val(CategoryIDList);

        $("#thirdLevelCategory tr td a").click(function () {
            $(this).parent().parent().remove();
            var cid = $(this).parent().parent().children("td:first").html();

            CategoryIDList.splice(CategoryIDList.indexOf(parseInt(cid)), 1);

            $("[id*=CaltegoryList]").val(CategoryIDList);

            //alert(CategoryIDList.indexOf(parseInt(cid)));

            $("[id*=" + cid + "]").css("background-color", "white");
            /*Enable Add Button*/
            $("[id*=" + cid + "]").css('pointer-events', 'auto');
            $("[id*=" + cid + "]").css('cursor', 'pointer');
        });
    }    
</script>
