@using PagedList;
@using PagedList.Mvc;
@model IPagedList<ModelLayer.Models.ViewModel.CategoryproductDetail>

@*<link href="~/Content/Site.css" rel="stylesheet" />*@
<script src="~/Content/js/jquery-1.9.1.min.js"></script>
<script src="~/Content/js/jquery.dataTables.min.js"></script>
<script src="~/Content/js/bootstrap.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $("#myTable").DataTable({
            "bDestroy": true,
            //"sPaginationType": "full_numbers",
            "bJQueryUI": true,
            "bInfo": false,
            "scrollY": 700,
            "scrollCollapse": true,
            "bPaginate": false,
            "iDisplayLength": 20,
            "bAutoWidth": false,

        });

    });
</script>



@{
    ViewBag.Title = "Index";
}


<style>
    .btn_Print {
        margin-bottom: 7px;
        margin-top: 7px;
        margin-left: 5px;
    }

    .section {
        position: relative;
        border: 1px solid #000;
        padding-top: 33px;
        margin-left: 5px;
        background: #A4A5A7;
        margin-top: 92px;
    }

    #myTable_wrapper {
        min-height: 61px;
        margin-top: 2px;
        max-height: 516px;
    }

    .fg-toolbar {
        margin-top: -89px;
    }

    #myTable_filter {
        position: absolute;
        margin-top: 13px !important;
    }

    .section.positioned {
        position: absolute;
        top: 100px;
        left: 100px;
        width: 800px;
        box-shadow: 0 0 15px #333;
    }

    .container_tbl {
        /*overflow-y: auto;*/
        height: 200px; /*height: 420px;*/
    }

    table {
        border-spacing: 0;
        width: 100%;
    }

    td + td {
        border-left: 1px solid #eee;
    }

    td, th {
        border-bottom: 1px solid #eee;
        /*background: #ddd;*/
        color: #000;
        padding: 10px 25px;
    }

    #myTable thead tr th {
        height: 0;
        line-height: 0 !important;
        padding-top: 0 !important;
        padding-bottom: 0 !important;
        color: transparent;
        border: none;
        white-space: nowrap;
    }

    th div {
        position: absolute;
        background: transparent;
        color: #fff;
        padding: 9px 10px;
        top: 0;
        margin-left: -8px;
        line-height: normal;
        /*border-left: 1px solid #800;*/ border-left: 1px solid #DDD;
    }

    th:first-child div {
        border: none;
    }

    .wrap {
        margin-top: 105px;
    }

    .ui-widget-header {
        border: none;
    }

    td:nth-of-type(2) {
        width: 300px;
    }
    /*td:nth-child(2) {
        width: 300px;
    }*/
    #myTable_wrapper, .scrollable #myTable {
        overflow-x: hidden;
    }
</style>
<div id="content" class="span10">
    <div class="row-fluid">
        <div class="box span12">
            <div class="box-header">
                <h2><i class="halflings-icon user"></i><span class="break"></span>Category Wise Product</h2>
            </div>
            <div class="box-content">
                <div class="span12" style="margin-top:10px;">
                    <div class="span3">
                        @*<span class="hed-owner">Select Franchise</span>*@
                        @Html.DropDownList("FranchiseList", null, "Select Franchise", new {onchange = "this.form.submit();" })
                        <label id="lblMsgFranchise" style="color:red"></label>
                    </div>
                    <div class="span9">
                        <div class="span2">Select Category</div>
                        <div class="span4">@Html.DropDownList("CategoryList")</div>
                        @using (Html.BeginForm("GetThirdLevelCategory", "CatWiseProductReport", FormMethod.Post, null))
                        {
                            <div class="span3">@Html.DropDownList("LevelTwoCategoryList")@Html.Hidden("Page", 1)</div>
                            <div class="span2"><input type="submit" value="Search" id="btnSearch" class="btn btnSearch-f btn-primary" style="float: right;"></div>
                        }

                    </div>

                </div>

                <div class="section">
                    <div class="table scrollable container_tbl">
                        <table class="table" id="myTable">
                            @if (Model.Count() == 0)
                            {
                                <tr>
                                    <td colspan="6" class="text-center"><h3>No Record Found...</h3></td>
                                </tr>
                            }
                            else
                            {
                                int i = 1;
                                <thead>
                                    <tr class="hed-tble header">
                                        <th>Sr.No.</th>
                                        <th>

                                            Category Name
                                        </th>
                                        <th>

                                            Approved Product Count
                                        </th>
                                        <th>

                                            NonApproved Product Count
                                        </th>


                                    </tr>
                                </thead>
                                foreach (var item in Model)
                                {

                                    <tr>
                                        <td>@{int SrNo = ((ViewBag.PageNumber - 1) * ViewBag.PageSize) + i; i = i + 1; } @SrNo</td>

                                        <td>@Html.ActionLink(item.Name, "GetProductInCategory", "CatWiseProductReport", new { CategoryID = item.ID }, null)</td>

                                        <td>
                                            @Html.DisplayFor(modelItem => item.ApprovedCount)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.NonApprovedCount)
                                        </td>


                                    </tr>
                                }
                            }

                        </table>

                    </div>
                </div>
                <div class="pager">
                    @Html.PagedListPager(Model, Page => Url.Action("GetThirdLevelCategory", "CatWiseProductReport", new
                       {
                           LevelTwoCategoryList = ViewBag.CatID,
                           page = Page,

                       }),
                                                                    new PagedListRenderOptions()
                                                                    {
                                                                        Display = PagedListDisplayMode.IfNeeded
                                                                    })
                </div>
            </div>
        </div>
    </div>
</div>








<script src="~/Content/js/jquery.1.8.3.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {

        $('#FranchiseList').change(function (e) {

            var id = $("#FranchiseList  option:selected").val();

            $.ajax({
                type: "POST",
                url: "/CatWiseProductReport/SelectLevelOneCategoryByFranchise",
                data: "{ id: " + id + "}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: true,
                cache: false,
                success: function (msg) {

                    $('#CategoryList').empty();
                    $('#CategoryList').append('<option value=0>First Level</option>');

                    $.each(msg, function (index, item) {

                        $('#CategoryList').append('<option value=' + item.ID + '>' + item.Name + '</option>');
                    });
                },
                error: function (x, e) {
                    alert("unable to Retrive Data No ");
                }

            });
        });



        $("#CategoryList").change(function () {
            /* Get the selected value of dropdownlist */
            var selectedID = $(this).val();
            var FranchiseID = $("#FranchiseList option:selected").val();
            var level = 1;

            $.ajax({
                type: "POST",
                url: "/CatWiseProductReport/SelectCategory/?ParentCategory=" + selectedID + "&level=2",
                dataType: "json",
                async: true,
                cache: false,
                success: function (msg) {
                    $('#LevelTwoCategoryList').empty();
                    $('#LevelTwoCategoryList').append('<option value=0>Second Level</option>');
                    $.each(msg, function (index, item) {
                        $('#LevelTwoCategoryList').append('<option value=' + item.ID + '>' + item.Name + '</option>');
                    });
                },
                error: function (x, e) {
                    alert("Sorry No Such Type of Category Is available. ");
                }
            });
        });
    });
</script>
