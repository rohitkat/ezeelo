@using PagedList;
@using PagedList.Mvc;
@model IPagedList<ModelLayer.Models.ViewModel.TrackSearchReportViewModel>
@{
    ViewBag.Title = "Index";
}



<link href="~/Content/css/Site.css" rel="stylesheet" />
<script src="~/Content/js/jquery-1.9.1.min.js"></script>
<script src="~/Content/js/jquery.dataTables.min.js"></script>
<script src="~/Content/js/bootstrap.min.js"></script>
<style>
    .matchdivheight {
        overflow: scroll;
        height: 450px;
    }

    .widget {
        margin-left: 37px;
    }

    .widget-content {
        margin-top: -8px;
        margin-left: -23px;
    }

    .btn_print {
        float: right;
        margin-top: -56px;
        margin-right: 395px;
    }

    .widget-content h4 span {
        float: right;
        margin-top: -42px;
        margin-right: 160px;
    }

    .dataTables_info {
        display: none;
    }

    .dataTables_paginate {
        display: none;
    }

    .dataTables_length {
        display: none;
    }

    .box-content {
        z-index: 1 !important;
    }

    .export a {
        border: 1px solid #ccc;
        padding: 4px 12px;
        background: #486086;
        color: #fff;
    }

        .export a:hover {
            background: #486056;
            color: #fff;
            text-decoration: none !important;
        }

    .bg-box {
        background: #F5F5F5 !important;
    }

    .dataTables_filter {
        float: right;
    }

    .btn-brown {
        color: #ffffff;
        background-color: #267196;
        border-color: #8AA0B9;
        background-image: none;
        filter: none;
        text-shadow: none;
        width: 47px;
        margin-left: 7px;
        padding: 1px !important;
    }
    .my_table {
        height: 1073px;
        overflow-y: scroll;
    }
    .btn-search {
        width: 76px;
        margin-left: 18px;
    }
    .box-header {
        background: rgba(137, 142, 149, 0.37);
    }
</style>
<script language="javascript" type="text/javascript">
    function PrintDivContent(divId) {
        var printContent = document.getElementById(divId);
        var WinPrint = window.open('', '', 'left=0,top=0,toolbar=0,sta­tus=0');
        WinPrint.document.write(printContent.innerHTML);
        WinPrint.document.close();
        WinPrint.focus();
        WinPrint.print();
    }
</script>


@{
    <div class="span10" id="content">
        <div class="row-fluid">
            <div class=" box span12 ">
                <div class="box-header"><h2 style="font-weight:bold;">Track Search Report</h2></div>
                <div class="box bg-box">
                    <div class="row-fluid" @*style="padding-left:44px;"*@>
                        <div class="span7">
                            @using (Html.BeginForm())
                            {

                                <div class="span12">
                                    <div class="span5">@Html.TextBox("StartDate", null, new { id = "StartDate", @class = "datepicker glyphicons-iconcalendar", @placeholder = "Start Date", @style = "margin-top:10px;", required="requird"})</div>
                                    <div class="span7">@Html.TextBox("EndDate", null, new { id = "EndDate", @class = "datepicker glyphicons-iconcalendar", @placeholder = "End Date", @style = "margin-top:10px;", required = "requird" }) <input type="submit" value="Search" class="btn btn-primary btn-search" onclick="return DateValidation()" /></div>
                                    <label id="lblMsg" style="color:red"></label>
                                </div>

                            }
                        </div>
                        <div class="span5" style="margin-top:11px; text-align:right;">
                            @using (Html.BeginForm("Export", "TrackSearchReport", FormMethod.Post, new { enctype = "multipart/form-data" }))
                            {

                                @Html.ActionLink("EXCEL", "Export", new { StartDate = ViewBag.StartDate, EndDate = ViewBag.EndDate, option = 1 }, new { @class = "btn btn-brown" })
                                @Html.ActionLink("CSV", "Export", new { StartDate = ViewBag.StartDate, EndDate = ViewBag.EndDate, option = 2 }, new { @class = "btn btn-brown" })
                                @Html.ActionLink("PDF", "Export", new { StartDate = ViewBag.StartDate, EndDate = ViewBag.EndDate, option = 3 }, new { @class = "btn btn-brown" })
                                @* @Html.ActionLink("PRINT", "PDF", new { StartDate = ViewBag.StartDate, EndDate = ViewBag.EndDate },new {target="_blank"})*@
                                <input value="PRINT" class="btn btn-brown" onclick="javascript:PrintDivContent('divToPrint');" />

                            }
                        </div>
                    </div>



                    <div class="box-content" id="divToPrint">
                        <div class="my_table">
                            <table class="table table-striped table-bordered ">
                                <thead>
                                    <tr>
                                        <th>
                                            Sr.No.
                                        </th>
                                        <th>
                                            @Html.DisplayNameFor(model => model.First().UserName)
                                        </th>
                                        <th>
                                            @Html.DisplayNameFor(model => model.First().CategoryName)
                                        </th>
                                        <th>
                                            @Html.DisplayNameFor(model => model.First().ShopName)
                                        </th>
                                        <th>
                                            @Html.DisplayNameFor(model => model.First().ProductName)
                                        </th>
                                        <th>
                                            @Html.DisplayNameFor(model => model.First().Date)
                                        </th>
                                        <th>
                                            @Html.DisplayNameFor(model => model.First().City)
                                        </th>
                                        <th>
                                            @Html.DisplayNameFor(model => model.First().Franchises) @*////added*@
                                        </th>

                                    </tr>
                                </thead>
                                @{int i = 1;}
                                @foreach (var item in Model)
                                {

                                    <tr>
                                        <td>@{int SrNo = ((ViewBag.PageNumber - 1) * ViewBag.PageSize) + i; i = i + 1; } @SrNo</td>

                                        <td>
                                            @Html.DisplayFor(modelItem => item.UserName)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.CategoryName)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.ShopName)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.ProductName)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Date)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.City)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Franchises) @*////added*@
                                        </td>

                                    </tr>
                                }

                            </table>
                        </div>
                    </div>
                    <div class="pager">
                        @Html.PagedListPager(Model, Page => Url.Action("Index", new
                       {
                           page = Page,
                           StartDate = ViewBag.StartDate,
                           EndDate = ViewBag.EndDate
                       }),
                                                                    new PagedListRenderOptions()
                                                                    {
                                                                        Display = PagedListDisplayMode.IfNeeded
                                                                    })
                        <h4><span>Total Count:&nbsp;@ViewBag.TotalCount</span></h4>
                    </div>
                </div>
            </div>
        </div>
    </div>

}
<script>
    function DateValidation() {
        var FromDate = $('#StartDate').val();
        var ToDate = $('#EndDate').val();

        if (FromDate != '' && ToDate != '') {
            FirstDate = FromDate.split('/');
            SecondDate = ToDate.split('/');
            var from = new Date(FirstDate[2], FirstDate[1], FirstDate[0]); //Year, Month, Date
            var to = new Date(SecondDate[2], SecondDate[1], SecondDate[0]);
            if (from > to) {
                $('[id*=lblMsg]').text('To Date must be greater than From Date.');
                return false;
            }
            else {
                $('[id*=lblMsg]').text('');
                return true;
            }
        }
    }
</script>