@model ModelLayer.Models.ViewModel.PurchaseOrderReplyViewModel
@using ModelLayer.Models.ViewModel

<style type="text/css">
    #msform1 fieldset:not(:first-of-type) {
        display: none;
    }

    .field-validation-error {
        color: #000000 !important;
    }

    .succes-msg {
        color: #31A012;
        font-size: 20px;
    }

    .beatpicker-clearButton button {
        display: none;
    }

    .input-parent button {
        display: none;
    }

    .textarea-adjust {
        width: 85%;
    }
    /*Beatpicker Css*/
    .beatpicker-clearButton button {
        display: none;
    }

    .input-parent button {
        display: none;
    }

    .header-navbar-button {
        position: absolute !important;
    }

    .beatpicker .main-nav .current-indicator {
        text-align: center !important;
    }

    .beatpicker .main-nav .prev1 {
        left: 0 !important;
        width: 14%;
        padding: 0px 10px;
        color: #fff;
        font-size: 16px;
    }

    .beatpicker .main-nav .next1 {
        right: 0 !important;
        width: 9%;
        color: #fff;
        font-size: 16px;
    }

    .beatpicker .main-nav .prev1:hover {
        left: 0 !important;
        width: 14%;
        padding: 0px 10px;
        color: #fff;
        font-size: 20px;
        cursor: pointer !important;
    }

    .beatpicker .main-nav .next1:hover {
        right: 0 !important;
        width: 9%;
        color: #fff;
        font-size: 20px;
        cursor: pointer !important;
    }

    #divImages .remove {
        background: url(/Content/img/remove-icon.png) no-repeat 0px 0px #fff;
        float: left;
        font-size: 0 !important;
        width: 23px !important;
        padding: 2px 4px;
    }
    /*Beatpicker Css End*/
</style>


<link href="~/Content/css/BeatPicker.min.css" rel="stylesheet" />
<script src="~/Content/js/jquery-1.11.0.min.js"></script>
<script src="~/Content/js/BeatPicker.js"></script>
<link href="~/Content/assets/css/style.css" rel="stylesheet" />
<script src="~/Content/js/jquery-1.9.1.min.js"></script>
<link href="http://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">
<link href="~/Content/assets/css/form-design.css" rel="stylesheet" />

<div class="row-fluid">
    <div class="box span12">
        <div style="text-align:right;padding-right:15px">
            Total Invoice Amount = @Html.TextBoxFor(model => model.OrderAmount, "", new { id = "lblOrderAmount"})
            @*@Html.HiddenFor(model => model.OrderAmount, new { id = "hdnOrderAmount" })*@
        </div>
        <div class="box-content">
            <table id="tbl" class="table table-striped table-bordered bootstrap-datatable datatable dataTable" width="100%">
                <tr>
                    <th>Product</th>
                    <th>Item</th>
                    <th>HSN Code</th>
                    <th>In Stock</th>
                    <th style="text-align:center">Required/ Remaining Quantity</th>
                    <th>Quantity</th>
                    <th>UnitPrice</th>
                    <th>MRP</th>
                    @*<th>SaleRate</th>*@
                    <th>CGST/Unit</th>
                    <th>SGST/Unit</th>
                    <th>IGST/Unit</th>
                    <th>Amount</th>                   
                    <th>Remark</th>
                </tr>
                @*@foreach (var item in Model)*@
                @for (int i = 0; i < Model.lPurchaseOrderReplyDetailViewModels.Count; i++)
                {
                    <tr>
                        <td class="table-shopping-cart-img" style="text-align: left;">
                            <img id=" imgproductimage" src="@Model.lPurchaseOrderReplyDetailViewModels[i].StockThumbPath" onerror="this.src = '/Content/Images/no_image.png'" style="width: 70px; height:70px;" alt=" eZeelo " />
                             @Html.HiddenFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].StockThumbPath)
                         </td>
                        <td>
                        @Model.lPurchaseOrderReplyDetailViewModels[i].ItemName

                        @Html.HiddenFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].PurchaseOrderReplyID)
                        @Html.HiddenFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].PurchaseOrderReplyDetailsID)
                        @Html.HiddenFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].ProductID)
                        @Html.HiddenFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].ProductVarientID)
                        @Html.HiddenFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].PurchaseOrderDetailID)
                        @Html.HiddenFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].GSTInPer)    
                    </td>
                    <td>@Model.lPurchaseOrderReplyDetailViewModels[i].HSNCode</td>
                        <td>
                            @Html.LabelFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].AvailableQuantity, @Model.lPurchaseOrderReplyDetailViewModels[i].AvailableQuantity.ToString(), new { text = @Model.lPurchaseOrderReplyDetailViewModels[i].AvailableQuantity, value = @Model.lPurchaseOrderReplyDetailViewModels[i].AvailableQuantity, id = "AvailableQuantity_" + i, placeholder = "0", Style = "width:30px" })
                            @Html.HiddenFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].AvailableQuantity)
                        </td>
                    <td>
                        @Html.LabelFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].RequiredQuantity, @Model.lPurchaseOrderReplyDetailViewModels[i].RequiredQuantity.ToString(), new { text = @Model.lPurchaseOrderReplyDetailViewModels[i].RequiredQuantity, value = @Model.lPurchaseOrderReplyDetailViewModels[i].RequiredQuantity, id = "RequiredQuantity_" + i, placeholder = "0", Style = "width:30px" })
                        @Html.HiddenFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].RequiredQuantity)
                      </td>                       
                        
                    <td>
                        @if(@Model.lPurchaseOrderReplyDetailViewModels[i].AvailableQuantity>0)
                        {
                             @Html.TextBoxFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].Quantity, null, new { id = "ReceivedQuantity_" + i, placeholder = "0", Style = "width:30px" })
                        }
                        else
                        {
                        @Html.TextBoxFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].Quantity, null, new { id = "ReceivedQuantity_" + i, placeholder = "0", Style = "width:30px",disabled="disabled" })
                        }
                        @Html.HiddenFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].Quantity)
                    </td>
                    <td>
                        @Html.LabelFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].BuyRatePerUnit, @Model.lPurchaseOrderReplyDetailViewModels[i].BuyRatePerUnit.ToString(), new { id = "BuyRatePerUnit_" + i, placeholder = "0", Style = "width:40px" })
                        @Html.HiddenFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].BuyRatePerUnit)
                    </td>
                        <td>
                        @*@Html.TextBoxFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].MRP, null, new { placeholder = "0", Style = "width:40px" })*@
                            @Html.LabelFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].MRP, @Model.lPurchaseOrderReplyDetailViewModels[i].MRP.ToString())
                            @Html.HiddenFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].MRP)
                            @Html.HiddenFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].SaleRate)
                        </td>
                       
                <td>
                        @*@Html.TextBoxFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].CGSTAmount, null, new { placeholder = "0", Style = "width:40px" })*@
                    @Html.LabelFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].CGSTAmount, @Model.lPurchaseOrderReplyDetailViewModels[i].CGSTAmount.ToString())
                    @Html.HiddenFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].CGSTAmount)
                    <span>(@Convert.ToDecimal(@Model.lPurchaseOrderReplyDetailViewModels[i].GSTInPer / Convert.ToDecimal(2))%)</span>
                </td>
                <td>
                        @*@Html.TextBoxFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].SGSTAmount, null, new { placeholder = "0", Style = "width:40px" })*@
                @Html.LabelFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].SGSTAmount, @Model.lPurchaseOrderReplyDetailViewModels[i].SGSTAmount.ToString())
                 @Html.HiddenFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].SGSTAmount)
                 <span>(@Convert.ToDecimal(@Model.lPurchaseOrderReplyDetailViewModels[i].GSTInPer / Convert.ToDecimal(2))%)</span>
                </td>
                <td>
                        @*@Html.TextBoxFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].IGSTAmount, null, new { placeholder = "0", Style = "width:40px" })*@
                @Html.LabelFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].IGSTAmount, @Model.lPurchaseOrderReplyDetailViewModels[i].IGSTAmount.ToString())
                @Html.HiddenFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].IGSTAmount)
                </td>
                <td>@Html.TextBoxFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].Amount, @Model.lPurchaseOrderReplyDetailViewModels[i].Amount.ToString(), new { @class = "txt", id = "Amount_" + i, placeholder = "0", Style = "width:80px",disabled="disabled" })
                 @Html.HiddenFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].Amount,new { id = "hdnAmount_" + i })
                 </td>
                @*<td>
                        @Html.TextBoxFor(model => @Model.lInvoiceDetailViewModels[i].ReorderLevel, @Model.lInvoiceDetailViewModels[i].ReorderLevel.ToString(), new { placeholder = "0", Style = "width:40px" })
                    </td>*@
                @*<td>
                    @Html.TextBoxFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].ExpiryDate, "{0:MM/dd/yyyy}", new { id = "ExpiryDate_" + i, @readonly = "readonly", placeholder = "Expiry Date", Style = "width:70px" })
                </td>*@
                <td>
                    @Html.TextBoxFor(model => @Model.lPurchaseOrderReplyDetailViewModels[i].ProductRemark, null, new { placeholder = "Remark", Style = "width:100px" })
                </td>
            </tr>
                }
            </table>
        </div>
    </div>
</div>


<script type="text/javascript">

    $(document).ready(function () {

        $(".btnRemove").click(function (evt) {
            evt.preventDefault();
            // Get the value from the clicked button
            var ProductVarientID = $(this).val();
            $("#ItemDetails").load("/PurchaseOrderReply/Remove", { 'ProductVarientID': ProductVarientID });
        });
    });
</script>

<script language="javascript">

    $(document).ready(function () {
        var table = document.getElementById('tbl');
        var rowLength = table.rows.length;


        for (var i = 0; i < rowLength - 1; i++) {
            $('.table #ExpiryDate_' + i).each(function () {
                $(this).datepicker({ dateFormat: 'mm/dd/yy' });
            });
        }


        for (var i = 0; i < rowLength; i++) {
            var OrderAmount = 0;

            $('.table #ReceivedQuantity_' + i).keyup(function () {
                var sum = 0;
                var rowindex = $(this).closest("tr")[0].rowIndex;
                var AvailableQuantity = parseInt($('.table tr:eq(' + rowindex + ') td:eq(3)').text());
                var Quantity = parseInt($('.table tr:eq(' + rowindex + ') td:eq(4)').text());
                var BuyRatePerUnit = parseFloat($('.table tr:eq(' + rowindex + ') td:eq(6)').text());
                var ReceivedQuantity = $(this).val();

              

                //var oldAmount = $('.table tr:eq(' + rowindex + ') td:eq(8)').text();


                if (isNaN(ReceivedQuantity)) {
                    alert('Enter Only Number!')
                    $(this).val('');
                    $('.table #Amount_' + (rowindex - 1)).val('0');
                    $('.table #hdnAmount_' + (rowindex - 1)).val('0');

                    // iterate through each td based on class and add the values
                    $(".txt").each(function () {

                        var value = $(this).val();
                        //alert(value)
                        // add only if the value is number
                        if (!isNaN(value) && value.length != 0) {
                            sum += parseFloat(value);
                        }
                    });
                    if (sum > 0) {
                        $('#lblOrderAmount').val(sum);
                        //$('#hdnOrderAmount').val(sum);                     
                    }
                    else {
                        $('#lblOrderAmount').val(0);
                        //$('#hdnOrderAmount').val(0);
                    }

                    return false;
                }

                if (parseInt(ReceivedQuantity) > parseInt(Quantity) || parseInt(ReceivedQuantity) > parseInt(AvailableQuantity)) {
                    alert('Quantity can not be greater than Available/Required Quantity.')
                    $(this).val('');
                    $('.table #Amount_' + (rowindex - 1)).val('0');
                    $('.table #hdnAmount_' + (rowindex - 1)).val('0');
                    // iterate through each td based on class and add the values
                    $(".txt").each(function () {

                        var value = $(this).val();
                        //alert(value)
                        // add only if the value is number
                        if (!isNaN(value) && value.length != 0) {
                            sum += parseFloat(value);
                        }
                    });
                    if (sum > 0) {
                        $('#lblOrderAmount').val(sum);
                        //$('#hdnOrderAmount').val(sum);                       
                    }
                    else {
                        $('#lblOrderAmount').val(0);
                        //$('#hdnOrderAmount').val(0);
                    }
                    return false;
                }

                //Calculate Product Amount as per quantity
                var Amount = (parseFloat(ReceivedQuantity) * parseFloat(BuyRatePerUnit));
                //$('.table tr:eq(' + rowindex + ') td:eq(8)').text(Amount);
                $('.table #Amount_' + (rowindex - 1)).val(Amount);
                $('.table #hdnAmount_' + (rowindex - 1)).val(Amount);

                // iterate through each td based on class and add the values
                $(".txt").each(function () {

                    var value = $(this).val();
                    //alert(value)
                    // add only if the value is number
                    if (!isNaN(value) && value.length != 0) {
                        sum += parseFloat(value);
                    }
                });
                //OrderAmount = (parseFloat(OrderAmount) + parseFloat($('.table tr:eq(' + rowindex + ') td:eq(8)').text()) - parseFloat(oldAmount));
                if (sum > 0) {
                    $('#lblOrderAmount').val(sum);
                    //$('#hdnOrderAmount').val(sum);
                }
                else {
                    $('#lblOrderAmount').val(0);
                    //$('#hdnOrderAmount').val(0);
                }
            });
        }
    });

    //30/5/2018
    $(document).ready(function () {
        $("#lblOrderAmount").attr("readonly", "readonly");
    });
</script>
