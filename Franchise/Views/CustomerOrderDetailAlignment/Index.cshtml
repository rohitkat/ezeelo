@model Franchise.Models.ViewModel.CustomerOrderAndItsCustomerOrderDetailViewModel
@using Franchise.Models.ViewModel;
@{
    ViewBag.Title = "Order Detail";
    Layout = "~/Views/Shared/_Layout_franchise2.cshtml";
    ModelLayer.Models.GetwayPaymentTransaction lGetwayPaymentTransaction = (ModelLayer.Models.GetwayPaymentTransaction)ViewBag.GetwayPaymentTransaction;
    string lStrTransactionID = "", lGateWayDescription = string.Empty;
    if (lGetwayPaymentTransaction != null)
    {
        lStrTransactionID = lGetwayPaymentTransaction.PaymentGetWayTransactionId;
        lGateWayDescription = lGetwayPaymentTransaction.Description;
    }
    List<TaxOnOrderViewModel> lTaxOnOrderViewModels = (List<TaxOnOrderViewModel>)ViewBag.TaxOnOrderViewModel;
    decimal lTotalTaxAmount = (lTaxOnOrderViewModels == null) ? 0 : lTaxOnOrderViewModels.Sum(x => x.TaxAmount);
}

<style>
    .false {
        background-color: rgba(255, 0, 0, 0.24);
    }

    .box-info {
        background-color: #fff;
    }

    .box-header {
        height: 16px;
        font-size: 16px;
        line-height: 16px;
        padding: 10px;
        /*background: #eee;*/
        -webkit-box-shadow: none;
        -moz-box-shadow: none;
        box-shadow: none;
        overflow: hidden;
    }

    .box {
        border: 2px solid #eee;
        background: #fff !important;
        margin-bottom: 28px;
    }

    .box-content {
        position: relative;
        z-index: 50;
        margin-top: -1px;
        padding: 10px;
        background: #fff !important;
    }

    ul.dashboard-list li {
        padding: 5px 0;
        list-style: none;
        border-bottom: 1px solid #eee;
        font-size: 12px;
    }

    ul.dashboard-list li {
        padding: 5px 0;
        list-style: none;
        border-bottom: 1px solid #eee;
        font-size: 12px;
    }

    .row-fluid h2 {
        font-size: 20px;
        line-height: 12px;
    }

    .box-icon {
        float: right;
        margin-top: -13px;
    }

    .box-icon1 {
        margin-top: -26px;
    }

    .dl-horizontal {
        margin-bottom: 7px;
    }

    .arrow-up {
        width: 0;
        height: 0;
        border-left: 5px solid transparent;
        border-right: 5px solid transparent;
        border-bottom: 10px solid black;
        display: inline-block;
    }

    .arrow-down {
        width: 0;
        height: 0;
        border-left: 5px solid transparent;
        border-right: 5px solid transparent;
        border-top: 10px solid black;
        display: inline-block;
    }

    .newright {
        margin-top: 8px;
        margin-right: 16px;
    }
</style>
<div class="widget">
    <div class="widget-header">
        <i class="icon-list-alt"></i>
        <h3>Customer Order Detail [ @Model.customerOrderViewModel.OrderCode ]</h3>
        <span style=" float: right;">
            @Html.ActionLink("Back To List", "Index", "CustomerOrderAlignment", null, new { @class = "btn btn-small btn-primary" })
            <a href="@Url.Action("forprint", "CustomerOrderDetailAlignment" , new { customerorderid=Model.customerOrderViewModel.COID })" target="_blank"><span class="btn btn-warning btn-small">&nbsp;Print</span></a>
            <a class="btn btn-small btn-warning" target="_blank" href="@Url.Action("viewlogs", "CustomerOrderDetailAlignment" , new { coid=Model.customerOrderViewModel.COID })">&nbsp;User Log</a>
            <a class="btn btn-small btn-warning" target="_blank" href="@Url.Action("ViewSystemLog", "CustomerOrderDetailAlignment", new { coid = Model.customerOrderViewModel.COID })">&nbsp;Order Log</a>&nbsp;
        </span>
    </div>
    <section class="content widget-content">
        <div class="row-fluid">
            <div class="span12">
                <!-- TABLE: LATEST ORDERS -->
                <div class="box box-info" style="border-top: 3px solid#00c0ef;">
                    <div class="box-header with-border">
                        <h3 class="box-title">Order List</h3>
                        <div class="box-tools pull-right" style="margin-top:-28px;">
                            <a href="@Url.Action("edit", "CustomerOrderDetailAlignment", new { COID = Model.customerOrderViewModel.COID })" title="Edit"><i class="fa fa-edit text-red text-bold halflings-icon edit"></i></a>
                            <a href="#" data-widget="collapse" id="minusanchore" class="arrow-down" title="Minimize"></a>
                            <!--<button class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>-->
                        </div>
                    </div><!-- /.box-header -->
                    <div class="box-body" id="box-body">
                        <div class="table-responsive" style="overflow:auto">
                            @*Yashaswi 30-7-2018*@
                            <table class="table no-margin" id="tbl">
                                <thead>
                                    <tr>
                                        <th>Sr.No</th>
                                        <th>Shop Order Code</th>
                                        <th style="text-align:center">Shop</th>
                                        <th style="text-align:center">Delivery Partner</th>
                                        <th>Product</th>
                                        <th>Size</th>
                                        <th>MRP</th>
                                        <th>Qty</th>
                                        <th>Sale Rate</th>
                                        <th>Total Amount</th>
                                        @*Yashaswi 30-7-2018*@
                                        <th>Retail Points</th>
                                        <th>Cashback Points</th>
                                        <th>Order Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{int SrNo = 0; }
                                    @foreach (var OrderDetail in Model.CustomerOrderDetailViewModels)
                                    {
                                        SrNo++;
                                        string str = (OrderDetail.IsActive) ? "true" : "false";
                                    <tr class="@str">
                                        <td> @SrNo </td>
                                        <td>
                                            @*<a href="#myModal" role="button" class="btn btn-small btn-primary" data-toggle="modal" onclick="Details('@OrderDetail.ShopOrderCode')">@OrderDetail.ShopOrderCode</a>*@
                                            <a href="@System.Configuration.ConfigurationManager.AppSettings["EZEELO_DELIVERY_URL"]/DeliveryOrderDetail/details?Shopordercode=@OrderDetail.ShopOrderCode" target="_blank">@OrderDetail.ShopOrderCode</a>
                                        </td>
                                        @*
        <td> @OrderDetail.ShopName </td>*@
                                        <td>
                                            <ul style="list-style:none;">
                                                <li class="dropdown">
                                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                                        @OrderDetail.ShopName
                                                    </a>
                                                    <ul class="dropdown-menu">
                                                        <li><a target="_blank" href="@Url.Action("index", "OrderTracking" , new { shop=OrderDetail.ShopName })">Shop : @OrderDetail.ShopName</a></li>
                                                        <li><a href="#">Contact Person : @OrderDetail.ShopContactPerson</a></li>
                                                        <li><a href="#">Contact No : @OrderDetail.ShopContactNo</a></li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </td>
                                        @*
        <td> @OrderDetail.DeliveryPartner </td>*@
                                        <td>
                                            <ul style="list-style:none;">
                                                <li class="dropdown">
                                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                                        @OrderDetail.DeliveryPartner
                                                    </a>
                                                    <ul class="dropdown-menu">
                                                        <li><a target="_blank" href="@Url.Action("index", "OrderTracking" , new { delivery=OrderDetail.DeliveryPartner })">Delivery Partner : @OrderDetail.DeliveryPartner</a></li>
                                                        <li><a href="#">Contact Person : @OrderDetail.DeliveryContactPerson</a></li>
                                                        <li><a href="#">Contact No : @OrderDetail.DeliveryContactNo</a></li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </td>
                                        <td> @OrderDetail.ProductName </td>
                                        <td>@OrderDetail.ProductSize</td>
                                        <td> @OrderDetail.MRP </td>
                                        <td> @OrderDetail.Qty </td>
                                        <td> @OrderDetail.SaleRate </td>
                                        <td> @OrderDetail.TotalAmount </td>
                                        <td> @OrderDetail.RetailPoints </td> @*Yashaswi 30-7-2018*@
                                        <td> @OrderDetail.CashbackPoints </td>
                                        <td> @OrderDetail.OrderStatus </td>
                                    </tr>
                                    }
                                </tbody>
                            </table>
                        </div><!-- /.table-responsive -->
                    </div><!-- /.box-body -->
                    <div class="box-footer clearfix">
                        <!--<a href="javascript::;" class="btn btn-sm btn-info btn-flat pull-left">Place New Order</a>
                        <a href="javascript::;" class="btn btn-sm btn-default btn-flat pull-right">View All Orders</a>-->
                    </div><!-- /.box-footer -->
                </div><!-- /.box -->
            </div><!-- /.col -->
        </div>

        <div class="row-fluid" style="background-color:#fff;">

            <div class="box span4" ontablet="span6" ondesktop="span4" style="border-top: 3px solid#f39c12; height: 300px;" id="boxaddress">
                <div class="box-header">
                    <h2><span class="break"></span>Shipping Address</h2>
                    <div class="box-icon box-tools pull-right">
                        <a href="@Url.Action("editshippingaddress", "CustomerOrderDetailAlignment" , new { id=Model.customerOrderViewModel.COID })" title="Edit"><i class="text-red text-bold halflings-icon edit"></i></a>

                        <a href="#" class="arrow-down" title="Minimize" id="minusanchore1"></a>
                    </div>
                </div>
                <div class="box-content" id="address1">
                    To,<br />
                    @Model.customerOrderViewModel.Customer,<br />
                    Address : @Model.customerOrderViewModel.ShippingAddress<br />
                    Pincode : @Model.customerOrderViewModel.Pincode<br />
                    Area : @Model.customerOrderViewModel.Area,<br />
                    City : @Model.customerOrderViewModel.City<br />
                    Primary Mobile : @Model.customerOrderViewModel.PrimaryMobile<br />
                    Secondary Mobile : @Model.customerOrderViewModel.SecondoryMobile<br />
                </div>
            </div><!--/span-->

            <div class="box span4" ontablet="span6" ondesktop="span4" style=" border-top: 3px solid#f39c12;" id="boxorderdetail">
                <div class="box-header">
                    <h2><span class="break"></span>Order Detail</h2>
                    <div class="box-icon">
                        <a href="#" class="arrow-down" id="minusanchore2"></a>
                    </div>
                </div>
                <div class="box-content" id="orderdetail" style="overflow-y:scroll; height:240px;">
                    <table class="table table-condensed">
                        <tr>
                            <td width="40%">Order</td>
                            <td width="60%">&nbsp;@Model.customerOrderViewModel.OrderCode</td>
                        </tr>
                        <tr>
                            <td>Date</td>
                            <td>&nbsp;@Model.customerOrderViewModel.CreateDate.ToString("dd/MM/yyyy, hh:mm tt")</td>
                        </tr>
                        <tr>
                            <td>Business Booster</td>
                            <td>&nbsp;@Model.customerOrderViewModel.IsBusinessBoosterPlanOrder</td>
                        </tr>
                        <tr>
                            <td>Payment Mode</td>
                            <td>&nbsp;@Model.customerOrderViewModel.PaymentMode</td>
                        </tr>
                        @{
                            if (lGateWayDescription != null && lGateWayDescription.Length > 0)
                            {
                                <tr>
                                    <td>GateWay</td>
                                    <td>&nbsp;@lGateWayDescription</td>
                                </tr>
                            }
                            if (lStrTransactionID != null && lStrTransactionID.Length > 0)
                            {
                                <tr>
                                    <td>Transaction ID</td>
                                    <td>&nbsp;@lStrTransactionID</td>
                                </tr>
                            }
                        }

                        <tr>
                            <td>PAN</td>
                            <td>&nbsp;@Model.customerOrderViewModel.PAN</td>
                        </tr>
                        <tr>
                            <td>Delivery Type</td>
                            <td>&nbsp;@Model.CustomerOrderDetailViewModels[0].DeliveryType</td>
                        </tr>
                        <tr>
                            <td>Delivery Date</td>
                            <td>@{string DeliveryDate = (Model.customerOrderViewModel.DeliveryDate != null) ? ((DateTime)Model.customerOrderViewModel.DeliveryDate).ToString("MMM-dd-yyyy") : string.Empty;} &nbsp;@DeliveryDate</td>
                        </tr>
                        <tr>
                            <td>Delivery Time</td>
                            <td>&nbsp;@Model.customerOrderViewModel.DeliveryTime</td>
                        </tr>
                        <tr>
                            <td>Device Used</td>
                            <td>&nbsp;@Model.customerOrderViewModel.DeviceType</td>
                        </tr>
                        <tr>
                            <td>DeviceID</td>
                            <td>&nbsp;@Model.customerOrderViewModel.DeviceID</td>
                        </tr>
                        <tr>
                            <td>Netowrk ID</td>
                            <td>&nbsp;@Model.customerOrderViewModel.NetworkIP</td>
                        </tr>
                        <tr>
                            <td>Created By</td>
                            <td>&nbsp;@Model.customerOrderViewModel.CreatedByUser</td>
                        </tr>
                        <tr>
                            <td>Created Date</td>
                            <td>&nbsp;@Model.customerOrderViewModel.CreateDate.ToString("dd/MM/yyyy, hh:mm tt")</td>
                        </tr>
                        <tr>
                            <td>Last Modified By</td>
                            <td>&nbsp;@Model.customerOrderViewModel.ModifyByUser</td>
                        </tr>
                        <tr>
                            <td>Last Modified Date</td>
                            <td>@{string ModifyDate = (Model.customerOrderViewModel.ModifyDate != null) ? ((DateTime)Model.customerOrderViewModel.ModifyDate).ToString("dd/MM/yyyy, hh:mm tt") : string.Empty;} &nbsp;@ModifyDate</td>
                        </tr>
                    </table>
                </div>
            </div><!--/span-->

            <div class="box span4 noMargin" ontablet="span12" ondesktop="span4" style=" border-top: 3px solid#f39c12; height: 300px;" id="boxaccount">
                <div class="box-header">
                    <h2><span class="break"></span>Accounts Info</h2>
                    <div class="box-icon">

                        <a href="#" class="arrow-down" title="Minimize" id="minusanchore3"></a>
                    </div>
                </div>
                <div class="box-content" id="orderamount" style="overflow-y:scroll; height:240px;">
                    @*<div class="todo">
                    *@
                    <dl class="dl-horizontal">
                        <dt>Order Amount</dt>
                        <dd><img src="~/Content/Images/indian_rupee.png" style="height:10px;" />&nbsp;@Model.customerOrderViewModel.OrderAmount</dd>
                        @*Yashaswi 30-7-2018*@
                        <dt>Retail Points</dt>
                        <dd>@Convert.ToInt16(Model.customerOrderViewModel.RetailPoints)</dd>
                        <dt>Cashback Points</dt>
                        <dd>@Model.customerOrderViewModel.CashbackPoints</dd>
                        <dt>Total TAX</dt>
                        <dd><img src="~/Content/Images/indian_rupee.png" style="height:10px;" />&nbsp;@lTotalTaxAmount</dd>
                        <dt>Delivery Charge</dt>
                        <dd><img src="~/Content/Images/indian_rupee.png" style="height:10px;" />&nbsp;@Model.CustomerOrderDetailViewModels.FirstOrDefault().GandhibaghCharge</dd>
                        <br />
                        <hr style="margin: 10px 0;" />
                        <dt>Coupon Code</dt>
                        <dd>&nbsp;@Model.customerOrderViewModel.CoupenCode</dd>
                        <dt>Coupon Amount</dt>
                        <dd><img src="~/Content/Images/indian_rupee.png" style="height:10px;" />&nbsp;@Model.customerOrderViewModel.CoupenAmount</dd>
                        @{
                            if (ViewBag.EarnedAmount != null && (decimal)ViewBag.EarnedAmount > 0)
                            {
                                <dt>Used Wallet</dt>
                                <dd><img src="~/Content/Images/_indian_rupee.png" style="height:10px;" /> @ViewBag.EarnedAmount</dd>
                            }
                        }
                        <dt>Points Used</dt>
                        <dd>&nbsp;@Model.customerOrderViewModel.NoOfPointUsed</dd>
                        <dt>Value Per Point</dt>
                        <dd><img src="~/Content/Images/indian_rupee.png" style="height:10px;" />&nbsp;@Model.customerOrderViewModel.ValuePerPoint</dd>
                        <br />
                        <hr style="margin: 10px 0;" />
                        <dt>Total Discount</dt>
                        <dd><img src="~/Content/Images/indian_rupee.png" style="height:10px;" />&nbsp;@ViewBag.TotalDiscount</dd>
                        <dt>Payable Amount</dt>
                        <dd><img src="~/Content/Images/indian_rupee.png" style="height:10px;" />&nbsp;@Model.customerOrderViewModel.PayableAmount</dd>
                        @*Added by Priti*@
                        <dt>Wallet Amount Used</dt>
                        @if (Model.customerOrderViewModel.MLMAmountUsed != null)
                        {
                            <dd><img src="~/Content/Images/indian_rupee.png" style="height:10px;" />&nbsp;@Model.customerOrderViewModel.MLMAmountUsed.Value</dd> @*Added by Priti on 24-12-2018*@
                        }
                        else
                        {
                            <dd><img src="~/Content/Images/indian_rupee.png" style="height:10px;" />&nbsp;0.00</dd> @*Added by Priti on 24-12-2018*@
                        }


                    </dl>
                    @*
                        </div>*@
                </div>
            </div>

        </div>

        <div class="row-fluid" style="background-color:#fff; margin-top:15px;">
            <div class="span4">
                <div class="box box-danger direct-chat direct-chat-warning" style="border-top: 3px solid#dd4b39; height:218px;" id="boxcustomerinfo">
                    <div class="box-header with-border">
                        <h3 class="box-title">Customer Info</h3>
                        <div class="box-icon box-icon1">
                            <a href="#" class="arrow-down" title="Minimize" id="minusanchore4"></a>
                            @*<a href="#" class="btn-close"><i class="halflings-icon remove"></i></a>*@
                        </div>
                    </div><!-- /.box-header -->
                    <div class="box-body" id="customerinfo">
                        <!-- Conversations are loaded here -->
                        <div class="direct-chat-messages">
                            <table class="table table-condensed">
                                <tr>
                                    <td>Customer</td>
                                    <td><a href="@Url.Action("index", "CustomerDetail" , new { customer=Model.customerOrderViewModel.Customer })">@Model.customerOrderViewModel.Customer</a></td>
                                </tr>
                                <tr>
                                    <td>Reg. Mobile</td>
                                    <td>@Model.customerOrderViewModel.RegMobile</td>
                                </tr>
                                <tr>
                                    <td>Reg. Email</td>
                                    <td>@Model.customerOrderViewModel.RegEmail</td>
                                </tr>
                                @*Yashaswi 30-7-2018*@
                                <tr>
                                    <td>Is Leader</td>
                                    <td>@Model.customerOrderViewModel.IsLeader</td>
                                </tr>
                                <!--<tr>
                                    <td>Delivery Date</td>
                                    <td>{{ OrderDetails.customerOrderViewModel.DeliveryDate | date:'MMM-td-yyyy' }}</td>
                                </tr>
                                <tr>
                                    <td>Delivery Time</td>
                                    <td>{{ OrderDetails.customerOrderViewModel.DeliveryTime }}</td>
                                </tr>-->
                            </table>
                        </div><!--/.direct-chat-messages-->
                    </div><!-- /.box-body -->
                </div><!--/.direct-chat -->
            </div><!--/span-->

            <div class="span8">
                <div class="box box-danger direct-chat direct-chat-warning" style="border-top: 3px solid#dd4b39;" id="boxpreviousorder">
                    <div class="box-header with-border">
                        <h3 class="box-title">Previous 5 Orders</h3>
                        <div class="box-icon box-icon1">
                            <a href="#" class="arrow-down" title="Minimize" id="minusanchore5"></a>
                        </div>
                    </div><!-- /.box-header -->
                    <div class="box-body" id="previousorder">
                        <!-- Conversations are loaded here -->
                        <div class="direct-chat-messages">
                            <table class="table table-condensed table-hover table-responsive table-striped">
                                <thead>
                                    <tr>
                                        <th>Order</th>
                                        <th>Amount</th>
                                        <th>Customer</th>
                                        <th>City</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                    </tr>

                                </thead>
                                <tbody>
                                    @foreach (var ord in Model.lThisCustomerPreviousOrderViewModel)
                                    {
                                        <tr>
                                            <td><a href="@Url.Action("index", "CustomerOrderDetailAlignment" , new { coid=ord.COID })"> @ord.OrderCode </a></td>
                                            <td><img src="~/Content/Images/indian_rupee.png" style="height:10px;" />&nbsp; @ord.PayableAmount </td>
                                            <td> @ord.Customer </td>
                                            <td> @ord.City </td>
                                            <td> @ord.OrderStatus </td>
                                            <td> @ord.CreateDate.ToString("dd/MM/yyyy, hh:mm tt") </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div><!--/.direct-chat-messages-->
                    </div><!-- /.box-body -->
                </div><!--/.direct-chat -->
            </div><!--/span-->
        </div>

    </section>
</div>
<script src="~/Content/js/jquery-2.1.3.min.js"></script>
<script>
    $(document).ready(function () {
        if ('@TempData["Message"]' != '') {
            alert('@TempData["Message"]')
        }
    });
</script>
<script>
    $(document).ready(function () {
        $("#minusanchore").click(function () {
            $("#box-body").slideToggle("fast");
            if ($('#minusanchore').hasClass('arrow-up')) {
                $('#minusanchore').removeClass('arrow-up')
                $('#minusanchore').addClass('arrow-down')
            }
            else {
                $('#minusanchore').removeClass('arrow-down')
                $('#minusanchore').addClass('arrow-up')
            }
        });

        $("#minusanchore1").click(function () {
            $("#address1").slideToggle("fast");
            if ($('#minusanchore1').hasClass('arrow-up')) {
                $('#minusanchore1').removeClass('arrow-up')
                $('#minusanchore1').addClass('arrow-down')
                $('#boxaddress').css("height", 300);

            }
            else {
                $('#minusanchore1').removeClass('arrow-down')
                $('#minusanchore1').addClass('arrow-up')
                $('#boxaddress').css("height", 40);
            }
        });

        $("#minusanchore2").click(function () {
            $("#orderdetail").slideToggle("fast");
            if ($('#minusanchore2').hasClass('arrow-up')) {
                $('#minusanchore2').removeClass('arrow-up')
                $('#minusanchore2').addClass('arrow-down')
                $('#boxorderdetail').css("height", 300);

            }
            else {
                $('#minusanchore2').removeClass('arrow-down')
                $('#minusanchore2').addClass('arrow-up')
                $('#boxorderdetail').css("height", 40);
            }
        });

        $("#minusanchore3").click(function () {
            $("#orderamount").slideToggle("fast");
            if ($('#minusanchore3').hasClass('arrow-up')) {
                $('#minusanchore3').removeClass('arrow-up')
                $('#minusanchore3').addClass('arrow-down')
                $('#boxaccount').css("height", 300);

            }
            else {
                $('#minusanchore3').removeClass('arrow-down')
                $('#minusanchore3').addClass('arrow-up')
                $('#boxaccount').css("height", 40);
            }
        });

        $("#minusanchore4").click(function () {
            $("#customerinfo").slideToggle("fast");
            if ($('#minusanchore4').hasClass('arrow-up')) {
                $('#minusanchore4').removeClass('arrow-up')
                $('#minusanchore4').addClass('arrow-down')
                $('#boxcustomerinfo').css("height", 218);

            }
            else {
                $('#minusanchore4').removeClass('arrow-down')
                $('#minusanchore4').addClass('arrow-up')
                $('#boxcustomerinfo').css("height", 40);
            }
        });

        $("#minusanchore5").click(function () {
            $("#previousorder").slideToggle("fast");
            if ($('#minusanchore5').hasClass('arrow-up')) {
                $('#minusanchore5').removeClass('arrow-up')
                $('#minusanchore5').addClass('arrow-down')
                $('#boxpreviousorder').css("height", 218);

            }
            else {
                $('#minusanchore5').removeClass('arrow-down')
                $('#minusanchore5').addClass('arrow-up')
                $('#boxpreviousorder').css("height", 40);
            }
        });
    });
</script>
