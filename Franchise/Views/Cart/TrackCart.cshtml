@{
    Layout = "~/Views/Shared/_LayoutPartial.cshtml";
}
@model IEnumerable<ModelLayer.Models.ViewModel.CartViewModel>
<style>
    th {
        background-color: #0094ff !important;
        color: #fff !important;
    }

    textarea {
        width: 80% !important;
        height: 100px !important;
    }
</style>
@{
    if (Model != null && Model.Count() != 0)
    {
        <table class="table table-striped table-bordered">
            <tr>
                <td style="background-color: #3f4a8a; color: #fff;">
                    CartID : @Model.FirstOrDefault().CartName
                    @if (!string.IsNullOrEmpty(Model.FirstOrDefault().OrderCode))
                    {
                        <span> , OrderCode : @Model.FirstOrDefault().OrderCode</span>
                    }
                    <br />
                    Customer Name : @Model.FirstOrDefault().CustomerName, Mobile : @Model.FirstOrDefault().CustomerMobile, Email : @Model.FirstOrDefault().CustomerEmail,
                    <br />
                    Shipping Address : @Model.FirstOrDefault().Adress
                </td>
                <td style="background-color: #3f4a8a; color: #fff;">
                    <input type="button" id="getPassword" value="Get Password" />
                    <br />
                    <span id="CartPassword" class="btn btn-small" style="cursor:default; text-align:left !important;">Use generated Code as Password.</span>
                    <a href="http://customer.test/nagpur/2/login" target="_blank" class="hidden btn btn-small btn-danger" id="placeOrder">Place Order</a>
                </td>
            </tr>
        </table>
    }
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th style="background-color:#0094ff">
                    Sr.No.
                </th>
                <th>
                    Product
                </th>
                <th>
                    Color
                </th>
                <th>
                    Size
                </th>
                <th>
                    Qty
                </th>
                <th>
                    MRP
                </th>
                <th>
                    Sale Rate
                </th>
                <th>
                    Total Amount
                </th>
            </tr>
        </thead>
        @{int i = 0;}
        @foreach (var item in Model)
        {

            <tr>
                <td>@{ i = i + 1; } @i</td>
                <td>
                    @Html.DisplayFor(modelItem => item.ProductName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.ProductColor)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.ProductSize)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Qty)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Price)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.SaleRate)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.CartAmount)
                </td>
            </tr>
        }

    </table>

    <table class="table table-striped table-bordered">
        <tr>
            <th colspan="2">Logs</th>
        </tr>
        <tr>
            <td style="width:50%;">
                <div style="height:250px; overflow:scroll; padding:0px; margin:0px;" id="CartLogs">
                    @{ Html.RenderAction("Index", "CartLog", new { CartID = Request.QueryString["CartID"] });}
                </div>

            </td>
            <td>
                @{ Html.RenderAction("Create", "CartLog", new { CartID = Request.QueryString["CartID"] });}
            </td>
        </tr>
    </table>
}
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
@section Myscripts{
    <script type="text/javascript">
    $('#getPassword').click(function () {
        var lCartid = @Convert.ToInt64(Request.QueryString["CartID"]);
        $.ajax({
            url: '@Url.Action("GetCartPassword", "Cart")?ID=' + lCartid,
            type: "GET",
            success: function (result) {
                var res = result.split(':');

                if(res[0] == 'Success')
                {
                    $('#CartPassword').html('Username : ' + res[1] + '<br />Password : ' + res[2]);
                    $('#placeOrder').removeClass("hidden");
                }
                else
                {
                    $('#CartPassword').html(res[1]);
                    $('#placeOrder').addClass("hidden");
                }
            },
            error: function (data) {
                $('#CartPassword').val('');
            }
        });
    });


    $('#createCartLog').click(function () {
        var Log = {};
        var lDescription = $('#Description').val();
        var lCartid = @Convert.ToInt64(Request.QueryString["CartID"]);
        var lStautsVal = $('#ddlStatus').val();
        var lGBOD = $('#txtGBOD').val();
        //alert(lStautsVal);
        //alert(lGBOD);
            Log.Description = lDescription;
            $.ajax({
                url: '@Url.Action("CreateCartLog", "CartLog")?CartID=' + lCartid + '&Description=' + lDescription + '&Status=' + lStautsVal + '&GBOD=' + lGBOD,
                type: "GET",
                success: function (result1) {
                    $('#serverMsg').html(result1);
                    $.ajax({
                        url : '@Url.Action("Index", "CartLog", new { CartID = Convert.ToInt64(Request.QueryString["CartID"]) })',
                        dataType: "html",
                        success: function (result) {
                            $('#CartLogs').html(result);
                        }
                    });
                },
                error: function (data) {
                    //$('#CartPassword').val('');
                }
            });
        $('#Description').val('');
        });


        $('#ddlStatus').change(function(){
            var lVal = $('#ddlStatus').val();
            if(lVal == 1)
            {
                $('#txtGBOD').removeClass("hidden");
            }
            else
            {
                $('#txtGBOD').addClass("hidden");
            }
        });

        $('#Description').keypress(function(e) {
            var tval = $('textarea').val(),
                tlength = tval.length,
                set = 150,
                remain = parseInt(set - tlength);
            $('#serverMsg').text(remain + " Character remains.");
            if (remain <= 0 && e.which !== 0 && e.charCode !== 0) {
                $('textarea').val((tval).substring(0, tlength - 1))
            }
        });
        $('#Description').change(function(){
            if($('#Description').val().length > 150)
            {
                $('#serverMsg').text("0-150 characters allowed.");
                $('#Description').val('');
            }
        });
    </script>
}