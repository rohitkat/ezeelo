@using PagedList;
@using PagedList.Mvc;
@model IPagedList<ModelLayer.Models.TrackSearch>
@{
    ViewBag.Title = "Index";
}



<link href="~/Content/css/Site.css" rel="stylesheet" />
<script src="~/Content/js/jquery-1.9.1.min.js"></script>
<script src="~/Content/js/jquery.dataTables.min.js"></script>
<script src="~/Content/js/bootstrap.min.js"></script>
<style>
    .matchdivheight {
        overflow: scroll;
        height: 450px;
    }

    .widget {
        margin-left: 37px;
    }

    .widget-content {
        margin-top: -8px;
        margin-left: -23px;
    }

    .btn_print {
        float: right;
        margin-top: -56px;
        margin-right: 395px;
    }

    .widget-content h4 span {
        float: right;
        margin-top: -42px;
        margin-right: 160px;
    }

    .dataTables_info {
        display: none;
    }

    .dataTables_paginate {
        display: none;
    }

    .dataTables_length {
        display: none;
    }

    .box-content {
        z-index: 1 !important;
    }

    .export a {
        border: 1px solid #ccc;
        padding: 4px 12px;
        background: #486086;
        color: #fff;
    }

        .export a:hover {
            background: #486056;
            color: #fff;
            text-decoration: none !important;
        }

    .dataTables_filter {
        float: right;
    }

    .btn-brown {
        color: #ffffff;
        background-color: #267196;
        border-color: #8AA0B9;
        background-image: none;
        filter: none;
        text-shadow: none;
        width: 47px;
        margin-left: 7px;
        padding: 1px !important;
    }

    .my_table {
        height: 1073px;
        overflow-y: scroll;
    }

    .btn-search {
        width: 76px;
        margin-left: 18px;
    }
</style>
<script language="javascript" type="text/javascript">
    function PrintDivContent(divId) {
        var printContent = document.getElementById(divId);
        var WinPrint = window.open('', '', 'left=0,top=0,toolbar=0,sta­tus=0');
        WinPrint.document.write(printContent.innerHTML);
        WinPrint.document.close();
        WinPrint.focus();
        WinPrint.print();
    }
</script>


@{
    <div class="span10" id="content">
        <div class="row-fluid">
            <div class=" box span12 ">
                <div class="box-header">
                    <h2><i class="icon-home"></i><span class="break"></span>Track Search Report</h2></div>
                <div class="box bg-box">
                    <div class="row-fluid" @*style="padding-left:44px;"*@>
                        <div class="span7" style="padding-left: 5px;">
                            @using (Html.BeginForm("_GetReport", "TrackReport", FormMethod.Post, new { enctype = "multipart/form-data" }))
                            {

                                <div class="span12">
                                    <div class="span5">@Html.TextBox("StartDate", null, new { id = "StartDate", @class = "datepicker glyphicons-iconcalendar", @placeholder = "Start Date", @style = "margin-top:10px;", required = "requird" })</div>
                                    <div class="span7">
                                        @Html.TextBox("EndDate", null, new { id = "EndDate", @class = "datepicker glyphicons-iconcalendar", @placeholder = "End Date", @style = "margin-top:10px;", required = "requird" })
                                    <input type="submit" id="btnSearch" value="Search" class="btn btn-small btn-warning1" onclick="return DateValidation()" />
                                </div>
                                <label id="lblMsg" style="color:red"></label>
                            </div>

                            }
                        </div>
                        <div class="span5" style="margin-top:11px; text-align:right;">
                            @using (Html.BeginForm("Export", "TrackReport", FormMethod.Post, new { enctype = "multipart/form-data" }))
                            {

                                @Html.ActionLink("EXCEL", "Export", new { StartDate = ViewBag.StartDate, EndDate = ViewBag.EndDate, option = 1 }, new { @class = "btn btn-brown" })
                                @Html.ActionLink("CSV", "Export", new { StartDate = ViewBag.StartDate, EndDate = ViewBag.EndDate, option = 2 }, new { @class = "btn btn-brown" })
                                @Html.ActionLink("PDF", "Export", new { StartDate = ViewBag.StartDate, EndDate = ViewBag.EndDate, option = 3 }, new { @class = "btn btn-brown" })
                                @* @Html.ActionLink("PRINT", "PDF", new { StartDate = ViewBag.StartDate, EndDate = ViewBag.EndDate },new {target="_blank"})*@
                                <input value="PRINT" class="btn btn-brown" onclick="javascript:PrintDivContent('divToPrint');" />
                               
                            }
                        </div>
                    </div>
                    <div>


                    </div>

                    <div>
                        @if(Model!=null)
                        {
                           
                             @Html.Partial("_GetReport",Model)
                            //Html.RenderPartial("_GetReport",Model);
                            
                        }

                    </div>
                    @*<div class="box-content" id="divToPrint">
                        <div class="my_table">
                            <table class="table table-striped table-bordered ">
                                <thead>
                                    <tr>
                                        <th>
                                            Sr.No.
                                        </th>
                                        <th>
                                           City
                                        </th>
                                        <th>
                                        Product NAme   
                                        </th>
                                        <th>
                                          Device Type
                                        </th>
                                        
                                        <th>
                                           Total Count
                                        </th>

                                    </tr>
                                </thead>
                                @{int i = 1;}
                                @foreach (var item in Model)
                                {

                                    <tr>
                                        <td>@{int SrNo = ((ViewBag.PageNumber - 1) * ViewBag.PageSize) + i; i = i + 1; } @SrNo</td>

                                        <td>
                                            @Html.DisplayFor(modelItem => item.City)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.ProductName)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.DeviceType)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.TotalCount)
                                        </td>
                                       
                                    </tr>
                                }

                            </table>
                        </div>
                    </div>*@


                    @*<div class="pager">
                        @Html.PagedListPager(Model, Page => Url.Action("Index", new
                       {
                           page = Page,
                           StartDate = ViewBag.StartDate,
                           EndDate = ViewBag.EndDate
                       }),
                                                                    new PagedListRenderOptions()
                                                                    {
                                                                        Display = PagedListDisplayMode.IfNeeded
                                                                    })
                        <h4><span>Total Count:&nbsp;@ViewBag.TotalCount</span></h4>
                    </div>*@
                </div>
            </div>
        </div>

       
    </div>

}

    <script type="text/javascript">
            $(function () {
                $("input#btnSearch").on('click', function () {
                    $('#loader_img').show();
                    var pagecount = 0;
                    var page = 1;
                    var toDate = $('#txtToDate').val();
                    var fromDate = $('#txtFromDate').val();
                    var shopID = 0;
                    if ($("select#shopID option:selected").val() > 0) {
                        shopID = $("select#shopID option:selected").val();
                    }
                    var isValid = ValidateDate(fromDate, toDate);
                    if (isValid == false) {
                        $('#loader_img').hide();
                        return;
                    }
                    $.ajax({
                        url: '@Url.Action("_GetReport", "TrackReport")',
                        data: {  'fromDate': fromDate, 'toDate': toDate},
                        type: "Post",
                        cache: false,
                        success: function (data) {
                            //alert(data);
                            $('#loader_img').hide();
                            $('#divReport').empty();
                            $('#divReport').append(data);
                        },
                        error: function (data) {

                        }
                    });
                });
            });

   


    function ValidateDate(fromDate, toDate) {
        if (fromDate == '' && toDate == '') {
            $('[id*=lblMsg]').text('Please Select From Date and To Date.');
            return false;
        }
        else if (fromDate == '') {
            $('[id*=lblMsg]').text('Please Select From Date.');
            return false;
        }
        else if (toDate == '') {
            $('[id*=lblMsg]').text('Please Select To Date.');
            return false;
        }

        if (fromDate != '' && toDate != '') {
            dateFirst = fromDate.split('/');
            dateSecond = toDate.split('/');
            var from = new Date(dateFirst[2], dateFirst[1], dateFirst[0]); //Year, Month, Date
            var to = new Date(dateSecond[2], dateSecond[1], dateSecond[0]);
            if (from > to) {
                $('[id*=lblMsg]').text('To Date must be greater than From Date.');
                return false;
            }
            else {
                $('[id*=lblMsg]').text('');
            }
        }
    }


   

 
    

    function DateValidation() {
        var FromDate = $('#StartDate').val();
        var ToDate = $('#EndDate').val();

        if (FromDate != '' && ToDate != '') {
            FirstDate = FromDate.split('/');
            SecondDate = ToDate.split('/');
            var from = new Date(FirstDate[2], FirstDate[1], FirstDate[0]); //Year, Month, Date
            var to = new Date(SecondDate[2], SecondDate[1], SecondDate[0]);
            if (from > to) {
                $('[id*=lblMsg]').text('To Date must be greater than From Date.');
                return false;
            }
            else {
                $('[id*=lblMsg]').text('');
                return true;
            }
        }
    }
</script>


