@*<copyright file="GetReport.cshtml" company="Ezeelo Consumer Services Pvt. Ltd.">
     Copyright (c) Ezeelo Consumer Services Pvt. Ltd. All rights reserved.
    </copyright>
    <author>Harshada Raghorte</author>*@
@{
    ViewBag.Title = "GetReport";
    //Layout = null;
}
@using PagedList;
@using PagedList.Mvc;
@model IPagedList<ModelLayer.Models.ViewModel.ShopDetailReportViewModel>

<link href="~/Content/css/Site.css" rel="stylesheet" />
<script src="~/Content/js/jquery-1.9.1.min.js"></script>
<script src="~/Content/js/jquery.dataTables.min.js"></script>
<script src="~/Content/js/bootstrap.min.js"></script>
<style>
    .totalcount {
        margin-right: 26px !important;
    }

    .fg-toolbar {
        margin-top: -130px !important;
    }

    .btn_Print {
        margin-bottom: 7px;
        margin-top: 7px;
        margin-left: 5px;
    }

    .section {
        position: relative;
        /*border: 1px solid #000;*/
        padding-top: 0px;
        margin-left: 5px;
        /*background: rgb(179, 159, 128);*/
        height: 480px;
        overflow-y: scroll;
    }

    .table th, .table td {
        border: 1px solid #e5e5e5 !important;
    }

    .section.positioned {
        position: absolute;
        top: 100px;
        left: 100px;
        width: 800px;
        box-shadow: 0 0 15px #333;
    }

    .container_tbl {
        height: 729px;
        background: #fff;
    }

    table {
        border-spacing: 0;
        width: 100%;
    }

    td + td {
        border-left: 1px solid #eee;
    }

    td, th {
        border-bottom: 1px solid #eee;
        /*background: #ddd;*/
        color: #000;
        padding: 10px 25px;
    }

    #myTable thead tr th {
        height: 0;
        line-height: 0 !important;
        padding-top: 0 !important;
        padding-bottom: 0 !important;
        color: transparent;
        border: none;
        white-space: nowrap;
    }

    th div {
        position: absolute;
        background: transparent;
        color: #fff;
        padding: 14px 10px;
        top: 0;
        margin-left: -8px;
        line-height: normal;
        border-left: 1px solid #DDD;
    }

    th:first-child div {
        border: none;
    }

    .wrap {
        margin-top: 105px;
    }

    td:nth-child(1) {
        max-width: 40px;
        word-wrap: break-word;
    }

    td:nth-child(2) {
        max-width: 135px;
        word-wrap: break-word;
    }

    td:nth-child(3) {
        max-width: 100px;
        word-wrap: break-word;
    }

    td:nth-child(4) {
        max-width: 47px;
        word-wrap: break-word;
    }

    td:nth-child(5) {
        max-width: 107px;
        word-wrap: break-word;
    }

    td:nth-child(6) {
        max-width: 107px;
        word-wrap: break-word;
    }

    td:nth-child(7) {
        max-width: 107px;
        word-wrap: break-word;
    }

    td:nth-child(8) {
        max-width: 107px;
        word-wrap: break-word;
    }

    td:nth-child(9) {
        max-width: 107px;
        word-wrap: break-word;
    }

    td:nth-child(10) {
        max-width: 107px;
        word-wrap: break-word;
    }

    td:nth-child(11) {
        max-width: 107px;
        word-wrap: break-word;
    }

    #myTable_wrapper {
        width: 96% !important;
        min-height: 61px;
        margin-top: 12px;
        max-height: 516px;
        background: #FFF;
        margin-top: 53px !important;
        overflow: scroll;
    }
    select {
        width: 165px;
        background-color: #ffffff;
        border: 1px solid #cccccc;
        text-transform: lowercase;
    }
    input[type="text"] {
        width: 150px;
    }
    form {
        margin: 15px 0 20px;
    }
    .btn-brown {
        color: #ffffff;
        background-color: #267196;
        border-color: #8AA0B9;
        background-image: none;
        filter: none;
        text-shadow: none;
        width: 47px !important;
        margin-left: 7px;
        padding: 1px;
    }
</style>
<div class="row-fluid">
    <div class="box span12" style="width: 96%; margin-top: 25px;">
        <div class="box-header">
            <h2><i class="icon-home"></i><span class="break"></span>Shop Sale Report</h2>
        </div>
        <div class="box-content viewCont" style="margin-bottom: 87px;">
            <div class="span8">
                @using (Html.BeginForm("GetReport", "ShopDetailsReport", FormMethod.Post, null))
                {
                @Html.AntiForgeryToken()
                <div class="span3 control-group forDate1">
                    @Html.DropDownList("Status", new List<SelectListItem>

                    {
                    new SelectListItem{ Text="Search By Status", Value = "0" },
                    new SelectListItem{ Text="Live", Value = "1" },
                    new SelectListItem{ Text="Not-Live", Value = "2" }

                    })
                </div>
                <div class="span3 control-group forDate2">
                    @Html.DropDownList("CatID", "Select Catagory")

                </div>
                <div class="span3 control-group forDate2">
                    @Html.TextBox("ShopName", null, new { ID = "Shop", @placeholder = "Shop Name" })
                </div>
                <div class="span2 control-group forDate2">
                    <button type="submit" value="Search" name="btnSubmit" class="btn btn-small btn-warning1" style="margin-top:2px;">
                        <span class="glyphicon glyphicon-search"></span> Search
                    </button>
                </div>

                @*<button type="submit" value="print" name="btnSubmit" class="btn btn-small btn-warning1">
                        <span class="glyphicon glyphicon-search"></span> Print
                    </button>*@


                }
                
            </div> 
            <div class="span4" style=" text-align: right; margin-top: 20px;">
                <div class="span12 control-group forDate2 forDate_res">
                    @*<input type="submit" value="Export" id="btnExport" class="btn btn-small btnSearch-f btn_ex" />
                <input type="submit" onclick="printReport();" value="Print" id="btnPrint" class="btn btn-small btnSearch-f btn_ex btn-primary" />*@
                    @Html.ActionLink("EXCEL", "Export", new
                     {
                         Status = ViewBag.Status,
                         option = 1,
                         print = 0,
                         ShopName = ViewBag.ShopName,
                         CatID = ViewBag.selectedCatID

                     }, new { @class = "btn btn-brown" })
                    @Html.ActionLink("CSV", "Export", new
                     {
                         Status = ViewBag.Status,
                         option = 2,
                         print = 0,
                         ShopName = ViewBag.ShopName,
                         CatID = ViewBag.selectedCatID

                     }, new { @class = "btn btn-brown" })
                    @Html.ActionLink("PDF", "Export", new
                     {
                         Status = ViewBag.Status,
                         option = 3,
                         print = 0,
                         ShopName = ViewBag.ShopName,
                         CatID = ViewBag.selectedCatID

                     }, new { @class = "btn btn-brown" })
                    @Html.ActionLink("Print", "Export", new
                     {
                         Status = ViewBag.Status,
                         option = 0,
                         print = 1,
                         ShopName = ViewBag.ShopName,
                         CatID = ViewBag.selectedCatID

                     }, new { @class = "btn btn-brown" })
                    <span id="msg" style="color:red"></span>
                </div>
                @*@Html.ActionLink("Print", "GetReport", "ShopDetailsReport", new { page = 1, Status = ViewBag.Status, ShopName = ViewBag.ShopName, print = 1 }, new { @class = "btn btn-small btn-warning1 btn_print", target = "_blank" })*@
            </div>
        </div>
    </div>
</div>
<div class="row-fluid" style="width: 96%;">
    <div class="box-content">
        <div class="section">
            <div class="table container_tbl">
                <table class="table" id="myTable">
                    @if (Model.Count() == 0)
                    {
                    <tr>
                        <td colspan="6" class="text-center"><h3>No Record Found...</h3></td>
                    </tr>
                    }
                    else
                    {
                        int i = 1;
                    <tr class="hed-tble">
                        <th>Sr No</th>
                        <th>
                            ShopName
                        </th>
                        <th>
                            Merchant Name
                        </th>
                        <th>
                            UserLogin ID
                        </th>
                        <th>
                            Login Email-ID
                        </th>
                        <th>
                            Login Mobile No
                        </th>
                        <th>
                            Password
                        </th>
                        <th>
                            IsLive
                        </th>
                        <th>
                            Address
                        </th>
                        <th>
                            Alternate Mobile
                        </th>
                        <th>
                            Landline No
                        </th>

                    </tr>
                        foreach (var item in Model)
                        {

                    <tr>
                        <td>@{int SrNo = ((ViewBag.PageNumber - 1) * ViewBag.PageSize) + i; i = i + 1; } @SrNo</td>
                        <td>
                            @Html.DisplayFor(modelItem => item.ShopName)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.MerchantName)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.UserLoginID)
                        </td>

                        @{string Email = "";}
                        <td>
                            @if (item.Email != null)
                                    {
                                        Email = item.Email;
                                    }

                            @Email
                        </td>

                        <td>
                            @Html.DisplayFor(modelItem => item.Mobile)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Password)
                        </td>
                        @if (item.IsLive == true)
                                {
                        <td>
                            Live
                        </td>
                                }
                                else
                                {
                        <td>
                            Not Live
                        </td>
                                }
                        @*@if (item.IsActive == true)
                            {
                                <td>
                                    Active
                                </td>
                            }
                            else
                            {
                                <td>
                                    InActive
                                </td>
                            }*@

                        <td>
                            @Html.DisplayFor(modelItem => item.Address)

                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.AlternateMobile)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.LandLine)
                        </td>

                    </tr>
                        }
                    }

                </table>

            </div>
        </div>
    </div>
</div>
<div class="pager">
    @Html.PagedListPager(Model, Page => Url.Action("GetReport", new
                       {
                           page = Page,
                           Status = ViewBag.Status,
                           ShopName = ViewBag.ShopName,
                           print = 0,
                           CatID = ViewBag.selectedCatID,

                       }),
                                                                    new PagedListRenderOptions()
                                                                    {
                                                                        Display = PagedListDisplayMode.IfNeeded
                                                                    })
    <h4><span>Total Count:&nbsp;@ViewBag.TotalCount</span></h4>
</div>




<script>
    $(document).ready(function () {
        $("#Pager .page-number").click(function (e) {
            $('#loader_img').show();
            var page = 1;
            var pagecount = 0;
            var print = 0;
            var page = parseInt($(this).html());
            if (page > 1) {
                pagecount = 1;
            }

            $.ajax({
                url: '@Url.Action("GetReport", "ShopDetailsReport")',
                data: { 'page': page, 'pagecount': pagecount, 'Status': Status, 'print': print },
                type: "POST",
                cache: false,
                success: function (data) {
                    //alert(data);
                    $('#loader_img').hide();
                    $('#divReport').empty();
                    $('#divReport').append(data);

                },
                error: function (data) {

                }
            });
        });
    });


    $("input#btnExport").on('click', function () {

        var print = 0;
        var option = 0;

        var Status = 0;

        if ($("select#Status option:selected").val() > 0) {
            Status = $("select#Status option:selected").val();
        }
        if ($("select#ExportOption option:selected").val() > 0) {
            option = $("select#ExportOption option:selected").val();
        }

        window.location.href = "/ShopDetailsReport/Export?&Status=" + Status + "&option=" + option + "&print=" + print;

    });

    function printReport() {
        //alert('in');
        var print = 1;
        var option = 0;
        var Status = 0;


        if ($("select#Status option:selected").val() > 0) {
            Status = $("select#Status option:selected").val();
        }
        if ($("select#ExportOption option:selected").val() > 0) {
            option = $("select#ExportOption option:selected").val();
        }

        var url = "/ShopDetailsReport/Export?&Status=" + Status + "&option=" + option + "&print=" + print;
        window.open(url, '_blank')


    };
</script>
